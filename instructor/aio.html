<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Statistical Comparisons using R: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #383838">Beta
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="color: #001483; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Statistical Comparisons using R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Statistical Comparisons using R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Statistical Comparisons using R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-Hypothesis-Testing.html">1. Introduction to Hypothesis Testing</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-Preparation-of-data.html">2. Preparation of Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-Correlation.html">3. Relationship Between Continuous Variables</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-Categorical-Variables.html">4. Categorical Variables</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-Continuous-Variable.html">5. Comparison Between Two Groups</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-ANOVA.html">6. Testing For More Than Two Groups</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-Multiple-Testing.html">7. Multiple testing, summary, and final exercises</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-Hypothesis-Testing"><p>Content from <a href="01-Hypothesis-Testing.html">Introduction to Hypothesis Testing</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/01-Hypothesis-Testing.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are inferential statistics?</li>
<li>What is a hypothesis?</li>
<li>How can I test a hypothesis?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define a null and alternative hypothesis</li>
<li>Understand the hypothesis-testing process</li>
<li>Recognise the different types of hypothesis testing errors</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="hypothesis-testing"><h2 class="section-heading">Hypothesis Testing<a class="anchor" aria-label="anchor" href="#hypothesis-testing"></a>
</h2>
<hr class="half-width">
<p>The following is a well-established research pipeline:</p>
<ol style="list-style-type: decimal">
<li>Define a research question, or hypothesis</li>
<li>Design an appropriate study or trial to test that hypothesis</li>
<li>Conduct the study or trial</li>
<li>Observe, collate and process the results (data)</li>
<li>Measure the agreement with the hypothesis</li>
<li>Draw conclusions regarding the hypothesis</li>
</ol>
<p>In this model, the hypothesis should be clearly defined and testable.
In hypothesis testing, this means that our question has just two
possible answers: a ”null hypothesis” (H<sub>0</sub>), which is a
specific statement that we are looking to disprove with our data, and an
“alternative hypothesis” (H<sub>1</sub>), which is a statement opposing
H<sub>0</sub> and which we will only accept if the data and analysis is
sufficiently convincing.</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="defining-your-alternative-hypothesis" class="callout-inner">
<h3 class="callout-title">Defining your alternative hypothesis<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>The alternative hypothesis must cover all options not included in the
null hypothesis; if H<sub>0</sub> is: “There is no difference between A
and B”, then H<sub>1</sub> must be: “A and B are different”, not: “A is
greater than B”. Generally, a two-sided test (“A and B are different”)
is regarded as better practice than a one-sided test (“A is greater than
B”).</p>
</div>
</div>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Imagine you were testing a new medical treatment. What might be the
most appropriate null and alternative hypotheses?</p>
<ol style="list-style-type: decimal">
<li>Null – the new treatment is worse than the existing treatment.
Alternative – the new treatment is better than the existing
treatment</li>
<li>Null – there is no difference between the new and old treatments.
Alternative – there is a difference between the new and existing
treatments</li>
<li>Null – there is a difference between the new and existing
treatments. Alternative – there is no difference between the new and
existing treatments</li>
<li>Null – there is no difference between the new and old treatments.
Alternative – the new treatment is better than the existing
treatment</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Option 2 is the correct answer - the default assumption (the null
hypothesis) is that there is no difference between the two treatments,
and we need convincing evidence to accept that the new treatment has a
different outcome (the alternative hypothesis).</p>
<p>Think about why the other options may not be suitable. Can you come
up with another valid null and alternative hypothesis?</p>
</div>
</div>
</div>
</div>
<p>When carrying out hypothesis testing, we normally use a standard
framework.</p>
<ol style="list-style-type: decimal">
<li>We establish our null and alternative hypothesis</li>
<li>We collect data, often by measurement or experimentation on a small
sample group representative of the whole population</li>
<li>From the data, we calculate a test statistic – an estimation of a
population parameter derived from the data – and a rejection region – a
range of values for the test statistic for which we would reject
H<sub>0</sub> and accept H<sub>1</sub>
</li>
<li>If the test statistic falls within the rejection region and we
accept H<sub>1</sub>, we can calculate a p-value, the probability of the
observed test statistic (or one more favourable to H<sub>1</sub>)
occurring if H<sub>0</sub> were true.</li>
</ol>
<p>Hypothesis testing is often used in inferential statistics, where
measurements are taken on a random sample from a large population in
order to estimate (or infer) something about that population as a whole.
Example of inferential statistics include opinion polls and drug
trials.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Would results from a population census be an example of inferential
statistics? If you are in a face to face class, you might like to
discuss this with your neighbour.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Probably not, because a census is an attempt to directly measure the
whole population, not just a representative sample. However there is
nearly always some missing data and inference may be used in an attempt
to compensate for that.</p>
</div>
</div>
</div>
</div>
</section><section id="p-values-and-rejection-of-the-null-hypothesis"><h2 class="section-heading">p-values and rejection of the null hypothesis<a class="anchor" aria-label="anchor" href="#p-values-and-rejection-of-the-null-hypothesis"></a>
</h2>
<hr class="half-width">
<ul>
<li>The null hypothesis is tested against the alternative one using a
distribution of a statistic.</li>
<li>The p-value is the probability of obtaining results as extreme as
the observed results of a statistical hypothesis test, assuming that the
null hypothesis is correct.</li>
<li>The probability of rejecting H<sub>0</sub>, given the truth of
H<sub>0</sub>, is called the significance level, denoted α (often
α=0.05, but as low as α=0.0000003 in some disciplines)</li>
<li>The significance level, denoted α, is the probability of rejecting
H<sub>0</sub> when H<sub>0</sub> is true. For instance, a significance
level of 0.05 indicates there is a 5% risk of incorrectly concluding a
difference exists when there is no actual difference (often α=0.05, but
can be as low as α=0.0000003 in some disciplines).</li>
<li>If the p-value &lt; 0.05, we are 95% confident when we reject
H<sub>0</sub><ul>
<li>Conclusion: we can reject H<sub>0</sub>
</li>
</ul>
</li>
</ul></section><section id="confidence-intervals"><h2 class="section-heading">Confidence intervals<a class="anchor" aria-label="anchor" href="#confidence-intervals"></a>
</h2>
<hr class="half-width">
<p>A confidence interval gives more information than the results of a
hypothesis test (reject or don’t reject): it provides a range of
plausible values for the parameter being studied. Example: If the sample
mean is used to estimate the population mean, the confidence interval
gives the upper and lower bounds of a range in which we have 95%
confidence that the real population mean occurs.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>What conclusion can you make if your analysis gives a p-value of
0.994?</p>
<ol style="list-style-type: decimal">
<li>You can accept the alternative hypothesis with high confidence</li>
<li>You can accept the alternative hypothesis with low confidence</li>
<li>There is insufficient evidence to reject the null hypothesis</li>
<li>You can neither accept nor reject the alternative hypothesis</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Option 3. If the p-value is above our chosen significance level
(commonly 0.05, 0.01 or 0.001) we don’t have sufficient evidence to
reject the null hypothesis. Note - this does not necessarily mean that
the null hypothesis is true, rather that we have don’t have adequate
justification to conclude otherwise.</p>
</div>
</div>
</div>
</div>
</section><section id="testing-errors"><h2 class="section-heading">Testing errors<a class="anchor" aria-label="anchor" href="#testing-errors"></a>
</h2>
<hr class="half-width">
<figure>In hypothesis testing, there are two possible causes for a false
conclusion: rejecting the null hypothesis when it is true (a type I
error), or failing to reject the null hypothesis when it is false (a
type II error). The probability of a type 1 error is given by the
p-value; it is possible to calculate the probability of a type II error,
but we will not cover that in this course. <img src="../fig/01-fig1.png" alt="Table showing Type 1 and Type 2 errors." class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Select appropriate and testable null and alternative hypotheses</li>
<li>Interpret p-values and statistical significance correctly</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-02-Preparation-of-data"><p>Content from <a href="02-Preparation-of-data.html">Preparation of Data</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/02-Preparation-of-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I import a dataset into R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Review the structure of a CSV datafile</li>
<li>Read a CSV file into a dataframe</li>
<li>Manage the assignment of data as factors or character strings</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="previewing-data"><h2 class="section-heading">Previewing data<a class="anchor" aria-label="anchor" href="#previewing-data"></a>
</h2>
<hr class="half-width">
<p>Prior to uploading any dataset into R for analysis, it is useful to
review the contents of that file to understand the structure of the
data. This will allow you to choose the best data structure for your
dataset, and will identify the relevant command and settings you need
when uploading the data to R.</p>
<p>For small files, like the one we are using today, this review can be
done with a simple text editor, either an app on your computer or from
within RStudio. For very large datasets this is not advisable - files
may take a very long time to open and may even crash your computer. Such
large files may have documentation explaining their format, or you may
need to use the <code>head</code> function to look at just the first
part of the file.</p>
<p>Today we will be working with a datafile based on a study into the
effects of treatment with the drug ursodeoxycholic acid on gallstones.
This is based on a real study (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1375471/" class="external-link">Hood et al,
1993</a>). In this study, detailed follow-up records were kept for 93
patients receiving various combinations of dietary intervention and
ursodeoxycholic acid treatment to investigate ways of reducing the risk
of gallstone recurrence. For our exercises today we will just use a
subset of the data, with dummy demographic data substituted for real
patient information.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Use RStudio “Files” window, your text editor of choice, or a
spreadsheet program to open and review the data file
<em>gallstones.csv</em> (do not overwrite the file by saving
afterwards). Consider the meaning of the headers and what the nature of
the data in each column might be; perhaps discuss with your neighbour if
you are in an in-person session. How many patient records are there in
the dataset?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The field contents are as follows:</p>
<ul>
<li>Patient_ID – a unique numerical identifier for each patient</li>
<li>Gender – female or male: one-letter character string</li>
<li>Age – patient’s age: numerical value in years</li>
<li>Height – patient’s height: numerical value in (probably) cm</li>
<li>Weight – patient’s weight: numerical value in (probably) kg</li>
<li>BMI – patient’s body mass index (weight/height in
m<sup>2</sup>)</li>
<li>Obese – is the patient obese (BMI&gt;30): 0=no, 1=yes;</li>
<li>Smoking.Status – does the patient smoke: 1=non-smoker,
2=smoker;</li>
<li>Alcohol.Consumption – does the patient drink alcohol: 1=no,
2=previously, 3=currently;</li>
<li>Treatment – did the patient receive the ursodeoxycholic acid
treatment: 0=untreated, 1=treated;</li>
<li>Rec – did gallstones recur: 0=no recurrence, 1=recurrence;</li>
<li>Mult – did the patient have multiple gallstones: 0=single stone,
1=multiple stones;</li>
<li>Diam – original gallstone diameter in mm;</li>
<li>Dis – time in months for gallstone dissolution</li>
</ul>
<p>There are a total of 37 patient records in this file</p>
</div>
</div>
</div>
</div>
</section><section id="importing-data"><h2 class="section-heading">Importing data<a class="anchor" aria-label="anchor" href="#importing-data"></a>
</h2>
<hr class="half-width">
<p>Once you’ve reviewed the contents of the data file, you can decide
how best to upload it into R. In this case, we have a tabular layout
with fields separated by commas - a CSV file - so we will use the
<code>read.csv</code> function to import this dataset.</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>When reading in tabular data in R, you can use either
<code>read.table</code> or a range of pre-configured aliases:
<code>read.csv</code>, <code>read.csv2</code>, <code>read.delim</code>
and <code>read.delim2</code>. These have function arguments already set
to correspond to a range of different formats of CSV (comma separated
value) and TSV (tab separated value) files.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The default settings of `read.csv` differ between R versions, so when running</span></span>
<span><span class="co"># the command, we need to specify the stringsAsFactors parameter</span></span>
<span><span class="va">gallstones</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gallstones.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now the file is uploaded, you can find out more about this dataset
using the <code>head</code>, <code>str</code> and <code>summary</code>
functions.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gallstones</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Patient_ID Gender Age Height Weight      BMI Obese Smoking.Status
1        P25      F  64    147     65 30.08006     1              2
2        P28      F  81    151     69 30.26183     1              2
3        P17      M  77    156     59 24.24392     0              2
4        P27      F  80    156     47 19.31295     0              2
5         P5      F  86    156     53 21.77844     0              2
6         P6      F  69    157     48 19.47341     0              1
  Alcohol.Consumption Treatment Rec Mult Diam Dis
1                   1         1   1    1    6   8
2                   2         0   1    1    7   6
3                   1         0   0    0   20  20
4                   3         1   0    0   15   2
5                   2         0   1    0   18  14
6                   3         1   0    0   19   8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gallstones</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	37 obs. of  14 variables:
 $ Patient_ID         : Factor w/ 37 levels "P1","P10","P11",..: 18 21 9 20 33 34 35 19 28 30 ...
 $ Gender             : Factor w/ 2 levels "F","M": 1 1 2 1 1 1 1 1 1 1 ...
 $ Age                : int  64 81 77 80 86 69 75 77 73 88 ...
 $ Height             : int  147 151 156 156 156 157 157 160 160 160 ...
 $ Weight             : int  65 69 59 47 53 48 46 55 51 54 ...
 $ BMI                : num  30.1 30.3 24.2 19.3 21.8 ...
 $ Obese              : int  1 1 0 0 0 0 0 0 0 0 ...
 $ Smoking.Status     : int  2 2 2 2 2 1 2 2 2 1 ...
 $ Alcohol.Consumption: int  1 2 1 3 2 3 2 3 3 3 ...
 $ Treatment          : int  1 0 0 1 0 1 0 1 0 1 ...
 $ Rec                : int  1 1 0 0 1 0 1 0 1 0 ...
 $ Mult               : int  1 1 0 0 0 0 1 0 0 1 ...
 $ Diam               : int  6 7 20 15 18 19 14 18 15 5 ...
 $ Dis                : int  8 6 20 2 14 8 8 4 15 3 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">gallstones</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   Patient_ID Gender      Age            Height          Weight     
 P1     : 1   F:21   Min.   :31.00   Min.   :147.0   Min.   : 46.0  
 P10    : 1   M:16   1st Qu.:67.00   1st Qu.:160.0   1st Qu.: 58.0  
 P11    : 1          Median :77.00   Median :163.0   Median : 65.0  
 P12    : 1          Mean   :72.57   Mean   :164.6   Mean   : 69.7  
 P13    : 1          3rd Qu.:85.00   3rd Qu.:168.0   3rd Qu.: 79.0  
 P14    : 1          Max.   :90.00   Max.   :189.0   Max.   :109.0  
 (Other):31                                                         
      BMI            Obese        Smoking.Status  Alcohol.Consumption
 Min.   :18.66   Min.   :0.0000   Min.   :1.000   Min.   :1.000      
 1st Qu.:21.78   1st Qu.:0.0000   1st Qu.:1.000   1st Qu.:2.000      
 Median :24.46   Median :0.0000   Median :2.000   Median :2.000      
 Mean   :25.51   Mean   :0.2973   Mean   :1.649   Mean   :2.243      
 3rd Qu.:30.09   3rd Qu.:1.0000   3rd Qu.:2.000   3rd Qu.:3.000      
 Max.   :34.72   Max.   :1.0000   Max.   :2.000   Max.   :3.000      
                                                                     
   Treatment           Rec              Mult             Diam      
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   : 3.00  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.: 6.00  
 Median :1.0000   Median :0.0000   Median :1.0000   Median :10.00  
 Mean   :0.5405   Mean   :0.4324   Mean   :0.5135   Mean   :11.41  
 3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:15.00  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :27.00  
                                                                   
      Dis       
 Min.   : 2.00  
 1st Qu.: 6.00  
 Median : 8.00  
 Mean   :10.68  
 3rd Qu.:12.00  
 Max.   :48.00  
                </code></pre>
</div>
</section><section id="columns-as-factors"><h2 class="section-heading">Columns as factors<a class="anchor" aria-label="anchor" href="#columns-as-factors"></a>
</h2>
<hr class="half-width">
<p>This shows, among other details, that the dataset consists of records
from 37 patients, aged 31 to 90, of whom 21 are female and 16 male.
Looking further, you may notice that patient identifier, which should be
unique, has been imported as a factor - this is probably not the best
option for a unique identifier so it would be best to convert this to
character strings.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gallstones</span><span class="op">$</span><span class="va">Patient_ID</span> <span class="op">&lt;-</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Patient_ID</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Patient_ID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:37] "P25" "P28" "P17" "P27" "P5" "P6" "P7" "P26" "P34" "P36" "P11" ...</code></pre>
</div>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>Sometimes patient ID is numeric and ordered according to recruitment.
In this situation, it can be used as a surrogate for time to check for
any biases over the course of the study.</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>How could you have modified your <code>read.csv</code> command so
that patient identifiers were imported as character strings in the first
place? What other issues might this have caused?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>You could use the <code>stringsAsFactors = FALSE</code> argument to
<code>read.csv</code>. But this would mean that Gender was also read in
as character strings, and that is best represented as a factor.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Open a data file in a text editor or RStudio file viewer</li>
<li>Use <code>read.table</code> or <code>read.csv</code> to import
data</li>
<li>Review a dataframe using <code>str</code> and
<code>summary</code>
</li>
<li>Convert columns from factors to string using
<code>as.character</code>
</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-03-Correlation"><p>Content from <a href="03-Correlation.html">Relationship Between Continuous Variables</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-Correlation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are continuous variables?</li>
<li>How do I evaluate the relationship between two continuous
variables?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Exploring data with scatter plots</li>
<li>Identifying positive and negative correlation</li>
<li>Identifying and applying appropriate correlation tests</li>
<li>Interpretation of correlation values and coefficient of
determination</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introducing-continuous-variables"><h2 class="section-heading">Introducing continuous variables<a class="anchor" aria-label="anchor" href="#introducing-continuous-variables"></a>
</h2>
<hr class="half-width">
<p>The first feature of our dataset we are going to investigate is to
look at relationships between continuous variables. A continuous
variable is one which can take any value between a minimum and maximum
possible value - measurements such as height, distance, or time.
Continuous variables can be of interest to researchers when they show
relationships in how they change; statistically we can evaluate
relatedness using correlation analysis.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Which of the following datasets are continuous variables?</p>
<ol style="list-style-type: decimal">
<li>The weight of a dog</li>
<li>The age of a dog</li>
<li>The breed of a dog</li>
<li>The colour of a dog</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>1 and 2 are both continous variables, although age in particular is
often recorded in whole (discrete) units such as months or years.
Neither breed nor colour are continuous - a dog can be a mixed breed,
and colour definitions may merge into each other, but neither has a
logical linear order (for example, neither a brown dog nor a Dalmation
are part of a single continuum between a white dog and a black dog)</p>
</div>
</div>
</div>
</div>
<p>A correlation measures the ‘degree of association’ between two
continuous variables. Associations can be:</p>
<ul>
<li>
<em>positive</em>: an increase in one variable is associated with an
increase in the other</li>
<li>
<em>negative</em>: an increase in one variable is associated with a
decrease in the other</li>
<li>
<em>non-linear</em>: as one variable increases, the other changes
but not in a consistant way</li>
</ul>
<figure><img src="../fig/03-fig1.png" alt="Graphs showing examples of positive and  negative correlation, non-correlated data, and non-linear correlation" class="figure mx-auto d-block"></figure></section><section id="previewing-relationships-with-scatter-plots"><h2 class="section-heading">Previewing relationships with scatter plots<a class="anchor" aria-label="anchor" href="#previewing-relationships-with-scatter-plots"></a>
</h2>
<hr class="half-width">
<p>The gallstones dataset contains a number of continuous variables. The
first step in studying potential relationships between these is to
examine them using scatter plots</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Height"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Weight"</span>,</span>
<span>     cex.lab<span class="op">=</span><span class="fl">0.8</span>, cex.main<span class="op">=</span><span class="fl">1</span>,pch<span class="op">=</span><span class="fl">1</span>, <span class="co"># Set some plot formatting</span></span>
<span>     main<span class="op">=</span><span class="st">"Scatter-plot of weight against height"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/03-Correlation-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>From this graph, there appears to be a correlation between height and
weight. We can look at this further using ggplot, which provides the
<code>geom_smooth</code> function with which you can add a line showing
the best correlation estimate</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gallstones</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Height</span>, y <span class="op">=</span> <span class="va">Weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/03-Correlation-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>As well as height and weight, the gallstones dataset contains a
number of other continuous variables, including age and BMI. Plot any
two of these to see if they show signs of correlation</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Using Weight and BMI as an example:
<code>plot(gallstones$Weight, gallstones$BMI)</code></p>
<p>As you might expect, increased weight seems to be associated with
increased BMI. Height is, as we’ve seen, correlated with weight but much
less so with BMI. Age does not seem to be correlated with any of the
other three variables.</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>You can use <code>for</code> loops as a quick and dirty way of
plotting all pairwise comparisons at once</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Note - this 4x4 arrangement may not display properly if you are using</span></span>
<span><span class="co"># a small screen. Try maximising the plot window before displaying</span></span>
<span><span class="co"># Alternatively use par(mfrow=c(2,2)) - this will generate 4 panes of plots</span></span>
<span><span class="co"># which you can scroll though using the arrows at the top of the panel</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">data1</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Age"</span>,<span class="st">"Height"</span>,<span class="st">"Weight"</span>,<span class="st">"BMI"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">data2</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Age"</span>,<span class="st">"Height"</span>,<span class="st">"Weight"</span>,<span class="st">"BMI"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">[</span>,<span class="va">data1</span><span class="op">]</span>, <span class="va">gallstones</span><span class="op">[</span>,<span class="va">data2</span><span class="op">]</span>, xlab<span class="op">=</span><span class="va">data1</span>, ylab<span class="op">=</span><span class="va">data2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Once you've looked at the graphs, reset the plotting layout</span></span>
<span><span class="fu">dev.off</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="calculating-the-degree-of-association"><h2 class="section-heading">Calculating the degree of association<a class="anchor" aria-label="anchor" href="#calculating-the-degree-of-association"></a>
</h2>
<hr class="half-width">
<p>Having visualised the data and identified that it shows signs of an
association between the variables, the next step is to quantify the
degree of association, or correlation between the variables. There are
different tests for measuring correlation, depending on the distribution
of those variables. Today we will focus mainly on two: Pearson’s
correlation coefficient and Spearman’s rank.</p>
<ul>
<li>Pearson’s correlation coefficient is used with two continuous
variables, both of which are normally distributed, and which show a
linear relationship.</li>
<li>Spearman’s rank is for when there are two continuous variables, but
at least one is not normally distributed.</li>
<li>Kendall’s Tau is for when there are two ranked categorical
variables.</li>
<li>An associated test, Shapiro-Wilk, can be used to determine whether
continuous variables can be treated as normally distributed or not.</li>
</ul>
<p>Both Pearson’s and Spearman’s tests calculate a correlation value
<em>r</em> between the two variables. This value indicates the degree of
association between the variables</p>
<table class="table"><tbody>
<tr class="odd">
<td>|r| = 0</td>
<td>No relationship</td>
</tr>
<tr class="even">
<td>|r| = 1</td>
<td>Perfect <strong>linear</strong> relationship</td>
</tr>
<tr class="odd">
<td>|r| &lt; 0.3</td>
<td>Weak relationship</td>
</tr>
<tr class="even">
<td>0.3 ≤ |r| ≤ 0.7</td>
<td>Moderate relationship</td>
</tr>
<tr class="odd">
<td>|r| = 0.7</td>
<td>Strong relationship</td>
</tr>
</tbody></table>
<figure><img src="../fig/03-fig4.png" alt="Graphs showing examples of strong (r = 0.7), weak (r = 0.3) and no (r = 0) correlation" class="figure mx-auto d-block"></figure><div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>p-values should never be reported for correlations in publications;
always report the r or r<sup>2</sup> instead. Because of the nature of
the test, the p-value can be significant when the strength of the
correlation is weak. It is normally fine to report p-values for most
other tests.</p>
</div>
</div>
</div>
<div id="callout3" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="coefficient-of-determination" class="callout-inner">
<h3 class="callout-title">Coefficient of determination<a class="anchor" aria-label="anchor" href="#callout3"></a>
</h3>
<div class="callout-content">
<p>Pearson’s <em><strong>r</strong></em> can be squared,
<em><strong>r<sup>2</sup></strong></em>, to derive a coefficient of
determination. This is the portion of variability in one of the
variables that can be accounted for by the variability in the second
one. For example, if the Pearson’s correlation coefficient between two
variables X and Y is -0.7 (strong negative relationship), 49% of the
variability in X is determined by the variability in Y</p>
</div>
</div>
</div>
<p>From our plot, we have already established that Height and Weight
seem to be correlated, so we will calculate the correlation value for
these variables.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, test if the variables are normally distributed</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/03-Correlation-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/03-Correlation-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Shapiro-Wilk normality test

data:  gallstones$Height
W = 0.89975, p-value = 0.002901</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Shapiro-Wilk normality test

data:  gallstones$Weight
W = 0.94652, p-value = 0.07454</code></pre>
</div>
<p>The p-value of the Shapiro-Wilk test for Height is less than 0.05, so
we reject the null hypothesis and conclude that Height is not normally
distributed. Therefore we should use Spearman’s test for this
analysis.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cor.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Spearman's rank correlation rho

data:  gallstones$Height and gallstones$Weight
S = 3246.8, p-value = 5.093e-05
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.6151261 </code></pre>
</div>
<p>The <em>rho</em> value of 0.615 shows a moderate relationship between
height and weight, and the p-value indicates that we can be highly
confident that the correlation is significantly different from zero.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Import the example dataset in the file “data/ep03_data.RData” using
the command <code>load("data/ep03_data.RData")</code>. This will load
three dataframes of x and y coordinates: data1, data2, and data3.
Without plotting the data, carry out some basic statistical tests (mean,
standard deviation, correlation) on the three dataframes and see if you
can characterise the differences between them. Then plot them and see if
your interpretations were correct.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Example commands: <code>mean(data1$x)</code>,
<code>sd(data2$y)</code>, <code>cor.test(data3$x, data3$y)</code></p>
<p>Example plot command: <code>plot(data1$x, data1$y)</code></p>
<p>Did you expect this result? Does it emphasise the importance of
visualising data?</p>
</div>
</div>
</div>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge4"></a>
</h3>
<div class="callout-content">
<p>The gallstones dataset contains two continuous variables about the
properties of patients’ gallstones - their diameter (<em>Diam</em>) and
the time taken for full dissolution (<em>Dis</em>). Is there evidence
for correlation of these properties?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>First, plot the data</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Diameter"</span>, ylab<span class="op">=</span><span class="st">"Dissolution time"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Plot of dissolution time against diameter"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>There is no obvious sign of correlation, but we can confirm that
mathematically</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test data for normality</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span><span class="op">)</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span><span class="op">)</span></span>
<span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span><span class="op">)</span></span>
<span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span><span class="op">)</span></span>
<span><span class="co"># Neither appears to be normally distributed, so use Spearman's correlation</span></span>
<span><span class="fu">cor.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre>
</div>
<p>The correlation coefficient is near zero, and the p-value not
significant - there is no evidence of a relationship between stone
diameter and time to dissolution</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Distinguish a continuous variable</li>
<li>Review data using <code>plot</code> and <code>ggplot</code>
</li>
<li>Test for normality of a dataset using <code>shapiro.test</code>
</li>
<li>Calculate correlation coefficient using <code>cor</code> and
<code>cor.test</code>
</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-04-Categorical-Variables"><p>Content from <a href="04-Categorical-Variables.html">Categorical Variables</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/04-Categorical-Variables.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a categorical variable?</li>
<li>What statistical tests are used with categorical data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Tests for use with categorical variables</li>
<li>Summarising categorical data with barcharts</li>
<li>Using factors to code categorical variables</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introducing-categorical-data"><h2 class="section-heading">Introducing categorical data<a class="anchor" aria-label="anchor" href="#introducing-categorical-data"></a>
</h2>
<hr class="half-width">
<p>Having looked at the gallstones dataset, you will have noticed that
many of the columns contain just two or three distinct values - for
example, M and F, or 1, 2, and 3. These are examples of
<strong>categorical</strong> data - where samples are assigned to one of
a limited number of fixed, distinct categories. Categories may be
emergent features of the data (for example ‘received treatment’ and ‘did
not receive treatment’) but others may be more arbitrary according to
the needs of the analysis (in this dataset, the three levels of alcohol
consumption relate to ‘no consumption’, ‘previous consumer’ and ‘current
consumer’).</p>
<p>Because categorical data typically has no intrinsic ordering to the
categories, we cannot study relationships between two variables by
looking for correlations. Instead, statistical analysis of categorical
data is based around count frequencies - are the numbers of samples in
each category what would be expected from random distribution, or do
certain categories occur together more often than would happen just by
chance?</p>
</section><section id="ordinal-data"><h2 class="section-heading">Ordinal data<a class="anchor" aria-label="anchor" href="#ordinal-data"></a>
</h2>
<hr class="half-width">
<p>An intermediate between categorical data and continuous data is
<strong>ordinal</strong> data. Unlike categorical data, ordinal data
does have natural order to the categories, but samples are still
assigned to one of a fixed number of categories. For example, it is
common on survey forms to see an ordinal age field: under 15, 15-25,
26-40, etc. Ordinal data is outside the scope of today’s workshop - talk
to a statistician if you need more advice.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Look again at the gallstones dataset. How many categorical fields
does it contain?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>There are seven categorical fields in this dataset: Gender, Obese,
Smoking.Status, Alcohol.Consumption, Treatment, Rec, and Mult</p>
</div>
</div>
</div>
</div>
</section><section id="using-factors-for-categorical-data"><h2 class="section-heading">Using factors for categorical data<a class="anchor" aria-label="anchor" href="#using-factors-for-categorical-data"></a>
</h2>
<hr class="half-width">
<p>With the exception of Gender, all the categorical variables in the
gallstones dataframe have been recorded as integer fields. This may
cause confusion because it would be possible in principle to analyse
these as continuous variables. R includes the factor data type, which
provides a way to store a fixed, predefined set of values. This makes it
ideal for working with categories, so we will convert those columns to
factors.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Either convert the columns one at a time</span></span>
<span><span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span> <span class="op">&lt;-</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span><span class="op">)</span> <span class="co"># and repeat for other five</span></span>
<span><span class="co"># Or all together: variables Obese to Mult (columns 7-12) need to be categorical</span></span>
<span><span class="va">gallstones</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span><span class="fu">lapply</span><span class="op">(</span><span class="va">gallstones</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># While we're at it, convert the levels to meaningful category names</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"NonObese"</span>, <span class="st">"Obese"</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Untreated"</span>, <span class="st">"Treated"</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"NoRecurrence"</span>, <span class="st">"Recurrence"</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Smoking.Status</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu">c</span><span class="op">(</span><span class="st">"NonSmoker"</span>,<span class="st">"Smoker"</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu">c</span><span class="op">(</span><span class="st">"NonAlcohol"</span>,<span class="st">"Previous"</span>,<span class="st">"Alcohol"</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Mult</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu">c</span><span class="op">(</span><span class="st">"Single"</span>,<span class="st">"Multiple"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gallstones</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	37 obs. of  14 variables:
 $ Patient_ID         : chr  "P25" "P28" "P17" "P27" ...
 $ Gender             : Factor w/ 2 levels "F","M": 1 1 2 1 1 1 1 1 1 1 ...
 $ Age                : int  64 81 77 80 86 69 75 77 73 88 ...
 $ Height             : int  147 151 156 156 156 157 157 160 160 160 ...
 $ Weight             : int  65 69 59 47 53 48 46 55 51 54 ...
 $ BMI                : num  30.1 30.3 24.2 19.3 21.8 ...
 $ Obese              : Factor w/ 2 levels "NonObese","Obese": 2 2 1 1 1 1 1 1 1 1 ...
 $ Smoking.Status     : Factor w/ 2 levels "NonSmoker","Smoker": 2 2 2 2 2 1 2 2 2 1 ...
 $ Alcohol.Consumption: Factor w/ 3 levels "NonAlcohol","Previous",..: 1 2 1 3 2 3 2 3 3 3 ...
 $ Treatment          : Factor w/ 2 levels "Untreated","Treated": 2 1 1 2 1 2 1 2 1 2 ...
 $ Rec                : Factor w/ 2 levels "NoRecurrence",..: 2 2 1 1 2 1 2 1 2 1 ...
 $ Mult               : Factor w/ 2 levels "Single","Multiple": 2 2 1 1 1 1 2 1 1 2 ...
 $ Diam               : int  6 7 20 15 18 19 14 18 15 5 ...
 $ Dis                : int  8 6 20 2 14 8 8 4 15 3 ...</code></pre>
</div>
</section><section id="visualising-categorical-data"><h2 class="section-heading">Visualising categorical data<a class="anchor" aria-label="anchor" href="#visualising-categorical-data"></a>
</h2>
<hr class="half-width">
<p>As with continuous data, it can often be useful to visualise
categorical data before starting on more complex analysis. We can do
this numerically with a simple count table, or graphically by expressing
that table as a bar graph. For this example, we will test whether there
is a relationship between obesity and the recurrence of gallstones.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise the data into a table.</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span><span class="op">)</span></span>
<span><span class="va">counts</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>              
               NonObese Obese
  NoRecurrence       17     4
  Recurrence          9     7</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">addmargins</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>              
               NonObese Obese Sum
  NoRecurrence       17     4  21
  Recurrence          9     7  16
  Sum                26    11  37</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Displaying as proportions may be easier to interpret than counts</span></span>
<span><span class="fu">round</span><span class="op">(</span><span class="fu">prop.table</span><span class="op">(</span><span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>              
               NonObese Obese
  NoRecurrence    65.38 36.36
  Recurrence      34.62 63.64</code></pre>
</div>
<p>Obese patients had a 63.6% chance of recurrence, non-obese patients
only 34.6%</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plots are generally easier to interpret than tables, so review data as a </span></span>
<span><span class="co"># bar graph</span></span>
<span><span class="fu">barplot</span><span class="op">(</span><span class="va">counts</span>, beside<span class="op">=</span><span class="cn">TRUE</span>, legend<span class="op">=</span><span class="fu">rownames</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'red'</span>,<span class="st">'blue'</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-Categorical-Variables-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ggplot can be used for higher quality figures, and to plot proportions rather</span></span>
<span><span class="co"># than counts</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gallstones</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Obese</span>, fill<span class="op">=</span><span class="va">Rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>position<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="va">percent</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        legend.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        legend.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        axis.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Obesity vs. Recurrence"</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/04-Categorical-Variables-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>From the charts and table it certainly looks like obesity is
associated with a higher rate of recurrence, so we will test whether
that is statistically significant.</p>
</section><section id="statistical-tests-for-categorical-variables"><h2 class="section-heading">Statistical tests for categorical variables<a class="anchor" aria-label="anchor" href="#statistical-tests-for-categorical-variables"></a>
</h2>
<hr class="half-width">
<p>To carry out a statistical test, we need a null and alternative
hypothesis. In most cases, the null hypothesis H<sub>0</sub> is that the
proportion of samples in each category is the same in both groups.</p>
<p>Our question: Is there a relationship between obesity and gallstone
recurrence?</p>
<p><em>Hypotheses</em>:<br>
H<sub>0</sub>: Gallstone recurrence is independent of obesity<br>
H<sub>1</sub>: Gallstone recurrence is linked with obesity</p>
<p>There are three main hypothesis tests for categorical variables:</p>
<ul>
<li>
<em>Chi-square test</em> <code>chisq.test()</code>: used when the
<em>expected</em> count in each cell of the table is greater than 5</li>
<li>
<em>Fisher’s exact test</em> <code>fisher.test()</code>: used when
the expected count of at least one cell is ≤ 5</li>
<li>
<em>McNemar test</em> <code>mcnemar.test()</code>: used for paired
data - for example, the proportion of patients showing a particular
symptom before and after treatment</li>
</ul>
<p>Which test do we need? The data is not paired, so it is not the
McNemar test. What are the expected counts for each cell?</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CrossTable from gmodels library gives expected counts, and also proportions</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gmodels</span><span class="op">)</span></span>
<span><span class="fu">CrossTable</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span>, </span>
<span>           format <span class="op">=</span> <span class="st">"SPSS"</span>, expected <span class="op">=</span> <span class="cn">T</span>, prop.chisq <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
   Cell Contents
|-------------------------|
|                   Count |
|         Expected Values |
|             Row Percent |
|          Column Percent |
|           Total Percent |
|-------------------------|

Total Observations in Table:  37 

               | gallstones$Obese 
gallstones$Rec | NonObese  |    Obese  | Row Total | 
---------------|-----------|-----------|-----------|
  NoRecurrence |       17  |        4  |       21  | 
               |   14.757  |    6.243  |           | 
               |   80.952% |   19.048% |   56.757% | 
               |   65.385% |   36.364% |           | 
               |   45.946% |   10.811% |           | 
---------------|-----------|-----------|-----------|
    Recurrence |        9  |        7  |       16  | 
               |   11.243  |    4.757  |           | 
               |   56.250% |   43.750% |   43.243% | 
               |   34.615% |   63.636% |           | 
               |   24.324% |   18.919% |           | 
---------------|-----------|-----------|-----------|
  Column Total |       26  |       11  |       37  | 
               |   70.270% |   29.730% |           | 
---------------|-----------|-----------|-----------|

 
Statistics for All Table Factors


Pearson's Chi-squared test 
------------------------------------------------------------
Chi^2 =  2.652483     d.f. =  1     p =  0.1033883 

Pearson's Chi-squared test with Yates' continuity correction 
------------------------------------------------------------
Chi^2 =  1.601828     d.f. =  1     p =  0.2056444 

 
       Minimum expected frequency: 4.756757 
Cells with Expected Frequency &lt; 5: 1 of 4 (25%)</code></pre>
</div>
<p>This is slightly complicated output, but we are most interested in
the “Expected Values” and “Column Percent” figures - the second and
fourth line of each box. These show:</p>
<ol style="list-style-type: decimal">
<li>The expected number of obese patients suffering recurrence is 4.757
(&lt;5)</li>
<li>The recurrence rate in non-obese patients is 34.6%, whereas in obese
patients it is 63.6%</li>
</ol>
<p>Because one expected value is less than 5, we should use Fisher’s
Exact test</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fisher.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Obese</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Fisher's Exact Test for Count Data

data:  gallstones$Obese and gallstones$Rec
p-value = 0.1514
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  0.6147706 19.2655239
sample estimates:
odds ratio 
  3.193654 </code></pre>
</div>
<p>Perhaps surprisingly given the plot data, the p-value of this test is
not significant; this means that there is insufficient evidence to
conclude that there is any difference in recurrence rates between obese
and non-obese patients. The apparently higher rate of recurrence in
obese patients is no more than might be expected by random chance in a
sample group of this size. It is possible however that we have made a
type II error and incorrectly failed to reject H<sub>0</sub> - we should
have consulted a statistician before gathering the data to check whether
the sample size provided sufficient statistical power to detect a
relationship.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>When would you use the Chi-square test?</p>
<ol style="list-style-type: decimal">
<li>When one variable is categorical and the other continuous</li>
<li>When there is categorical data with more than five counts expected
in each cell</li>
<li>When there is paired categorical data</li>
<li>You can use it interchangeably with Fisher’s Exact test</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Answer: 2</p>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Repeat the analysis to test whether recurrence is affected by
treatment.</p>
<p>Prepare simple and proportion/expected tables, prepare a bar chart,
identify and perform the appropriate statistical test.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the initial counts table</span></span>
<span><span class="va">counts2</span> <span class="op">&lt;-</span> <span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="va">counts2</span></span>
<span></span>
<span><span class="co"># Plot using barplot</span></span>
<span><span class="fu">barplot</span><span class="op">(</span><span class="va">counts2</span>, beside <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">counts2</span><span class="op">)</span>, </span>
<span>        col <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'red'</span>,<span class="st">'blue'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Or plot using ggplot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gallstones</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Treatment</span>, fill<span class="op">=</span><span class="va">Rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>position<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="va">percent</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        legend.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        legend.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        axis.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Treatment vs. Recurrence"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Look at expected values to select Chi-square or Fisher's Exact</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gmodels</span><span class="op">)</span> <span class="co"># Optional if the library is already installed</span></span>
<span><span class="fu">CrossTable</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Treatment</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,format<span class="op">=</span><span class="st">"SPSS"</span>,prop.chisq<span class="op">=</span><span class="cn">F</span>,expected<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All expected values are greater than 5</span></span>
<span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, correct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<p>Again, despite the barplot suggesting an association, the p-value is
non-significant, so we reject the alternative hypothesis that treatment
has an effect on recurrence rate</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Convert dataframe columns to factors using
<code>as.factor</code>
</li>
<li>Draw barcharts using <code>plot</code> and <code>ggplot</code>
</li>
<li>Select an appropriate statistical test for a categorical
dataset</li>
<li>Analyse categorical data using <code>chisq.test</code> and
<code>fisher.test</code>
</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-05-Continuous-Variable"><p>Content from <a href="05-Continuous-Variable.html">Comparison Between Two Groups</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/05-Continuous-Variable.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Do two sample groups differ for a continuous trait?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Tests for use with comparison of two groups of continuous data</li>
<li>Summarising continuous data graphically</li>
<li>Selecting and using relevant statistical tests</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="comparison-of-two-sample-groups"><h2 class="section-heading">Comparison of two sample groups<a class="anchor" aria-label="anchor" href="#comparison-of-two-sample-groups"></a>
</h2>
<hr class="half-width">
<p>Earlier we discussed continuous data, and how to investigate
relationships (correlations) between two continuous variables. In this
section, we will learn how to identify whether a single continuous trait
differs between two sample groups - a two sample test. Specifically, we
will investigate whether there is a statistically-significant difference
between the distribution of that variable between the two groups. As an
example, we will test whether male patients in our gallstones study are
taller than female patients.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="discussion" class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>See if you can identify other examples where you might use a two
sample groups comparison. Do you have any in your own research?</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="choosing-the-relevant-test">Choosing the relevant test<a class="anchor" aria-label="anchor" href="#choosing-the-relevant-test"></a>
</h3>
<p>As with testing for categorical variables, there are a range of
different statistical analyses for two sample group comparisons; the
appropriate one to use is determined by the nature of the dataset. There
are two primary questions we need to ask to identify the relevant test:
are the two datasets normally-distributed, and are the data paired (that
is, are there repeated measurements on the same samples)? The figure
below summarises the choice of statistical test used for each of these
cases.</p>
<figure><img src="../fig/05-fig1.png" alt="Decision tree to determine appropriate test to use.  Question one - Are the data normally distributed? Question 2 - Are the data paired? If the data are both normally distributed and paired, us a paired T-test If the data are normally distributed but not paired, use a T-test If the data are not normally distributed but are paired, use the Wilcoxon signed rank test If the data are neither normally distributed nor paired, use the Mann-Whitney test" class="figure mx-auto d-block"></figure><p>The first step is to determine whether the continuous variable in
each group is normally distributed. We’ve already learned about the
<code>shapiro.test</code> function to test for normality, and can use
that again in this situation.</p>
<p>The second decision is to identify whether the data is paired or not.
Paired data is when the two groups are the same test samples but
measured under different conditions (for example, a group of patients
tested before and after treatment), unpaired is when the two groups are
independent (for example, two separate groups of patients, one group
treated and one untreated).</p>
<p>There are a few further subtleties beyond this which we will come to
in a moment, but these are the two major determining factors in choosing
the correct test.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>In our gallstones dataset, assume that BMI is normally distributed
for patients with a recurrence of gallstones and not normal for those
with no recurrence. Which test would we use to investigate whether those
two groups (with and without recurrence) had different BMIs?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>One data set is normally distributed, the other is not, so we choose
the option for non-normally distributed data - the branch to the right
(we can only answer yes to the first question if both datasets are
normal). The data is not paired - the patients with recurrence are a
different group to those without. In this case we would use the
Mann-Whitney test.</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="two-sample-students-t-test"><h2 class="section-heading">Two sample Student’s T-test<a class="anchor" aria-label="anchor" href="#two-sample-students-t-test"></a>
</h2>
<hr class="half-width">
<p>If data is normally distributed for <strong>both</strong> groups, we
will generally use the Student’s T-test. This compares the means of two
groups measured on the same continuous variable. Tests can be two-sided
(testing whether the groups are not equal) or one-sided (testing either
whether the second group is greater than or less that the first). As we
discussed in the introduction, generally a two-sided test is preferred
unless there is a specific reason why a single-sided one is
justified.</p>
<table class="table">
<colgroup>
<col width="37%">
<col width="29%">
<col width="33%">
</colgroup>
<tbody>
<tr class="odd">
<td align="right">H<sub>0</sub>: µ<sub>1</sub> = µ<sub>2</sub>
</td>
<td align="center">against</td>
<td>H<sub>1</sub>: µ<sub>1</sub> ≠ µ<sub>2</sub> (two‑sided)</td>
</tr>
<tr class="even">
<td align="right"></td>
<td align="center">or</td>
<td></td>
</tr>
<tr class="odd">
<td align="right">H<sub>0</sub>: µ<sub>1</sub> &lt;= µ<sub>2</sub>
</td>
<td align="center">against</td>
<td>H<sub>1</sub>: µ<sub>1</sub> &gt; µ<sub>2</sub> (greater)</td>
</tr>
<tr class="even">
<td align="right"></td>
<td align="center">or</td>
<td></td>
</tr>
<tr class="odd">
<td align="right">H<sub>0</sub>: µ<sub>1</sub> &gt;= µ<sub>2</sub>
</td>
<td align="center">against</td>
<td>H<sub>1</sub>: µ<sub>1</sub> &lt; µ<sub>2</sub> (less)</td>
</tr>
</tbody>
</table>
<p>If <strong>equal variance</strong>: Student’s T-test<br>
If <strong>unequal variance</strong>: Welch’s two-sample T-test<br>
If <strong>data are paired</strong>: Student’s paired T-test</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>The R <code>t.test</code> function combines all three of these tests,
and defaults to Welch’s two-sample T-test. To perform a standard T-test,
use the parameter setting <code>var.equal = TRUE</code>, and for a
paired T-test, use <code>paired = TRUE</code>.</p>
</div>
</div>
</div>
</section><section id="two-sample-mann-whitney-test"><h2 class="section-heading">Two sample Mann-Whitney test<a class="anchor" aria-label="anchor" href="#two-sample-mann-whitney-test"></a>
</h2>
<hr class="half-width">
<p>Unless <strong>both</strong> groups are normally distributed, use the
Mann-Whitney test. This is a non-parametric test analogous to the
unpaired T-test, used when the <em>dependent</em> variable is
non-normally distributed</p>
<p>The Mann-Whitney test compares the medians of the two groups rather
than the means, by considering the data as rank order values rather than
absolute values.</p>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>The <code>wilcox.test</code> function in R defaults to unpaired data
- effectively returning the Mann-Whitney test instead. Carry out a
paired Wilcox test with the <code>paired = TRUE</code> argument</p>
</div>
</div>
</div>
</section><section id="two-sample-test-example"><h2 class="section-heading">Two sample test example<a class="anchor" aria-label="anchor" href="#two-sample-test-example"></a>
</h2>
<hr class="half-width">
<p>Is there a difference in height between females and males in the
gallstones dataset?</p>
<p>Height: Continuous variable<br>
Gender: Categorical variable with two levels<br>
Null hypothesis: There is no difference in height between the groups</p>
<p><em>Step one - visualise the data</em><br>
We will start by reviewing the data using a boxplot to see if there is
an indication of difference between the groups</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, </span>
<span>     col<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">'red'</span>,<span class="st">'blue'</span><span class="op">)</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">'Height'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Gender'</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-Continuous-Variable-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Visually there certainly appears to be a difference. But is it
statistically significant?</p>
<p><em>Step two - is the data normally distributed?</em></p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span><span class="op">[</span><span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">'F'</span><span class="op">)</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Histogram of heights of females"</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span><span class="op">[</span><span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">'M'</span><span class="op">)</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Histogram of heights of males"</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/05-Continuous-Variable-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>This doesn’t look very normally-distributed, but we do have
relatively few data points. A more convincing way to determine this
would be with the Shapiro-Wilks test</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Gender: F

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.94142, p-value = 0.2324

------------------------------------------------------------ 
gallstones$Gender: M

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.88703, p-value = 0.05001</code></pre>
</div>
<p>Neither test gives a significant p-value, so in the absence of
sufficient evidence to accept the alternative hypothesis of
non-normality, we treat the data as if it were normal; that is, we use a
T-test</p>
<p><em>Step three - are variances equal?</em></p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A quick and dirty test - how similar are the standard deviations?</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">sd</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Gender: F
[1] 5.518799
------------------------------------------------------------ 
gallstones$Gender: M
[1] 9.993331</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Or properly test for equality of variance using Levene's test</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">DescTools</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Registered S3 method overwritten by 'DescTools':
  method         from 
  reorder.factor gdata</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">LeveneTest</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value  Pr(&gt;F)  
group  1  3.4596 0.07131 .
      35                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<p>Although the standard deviations of the two groups (and hence the
variances) seem to be quite different, Levene’s test gives a
non-significant p-value of 0.07. This means that we shouldn’t reject the
null hypothesis of equal variance, and so we should perform a Student’s
T-test. If the variances had been different, then we would have used
Welch’s two-sample T-test instead.</p>
<p><em>Step four - carry out a T-test</em></p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify equal variance using the var.equal = TRUE argument.</span></span>
<span><span class="co"># var.equal would be set to FALSE if the p-value of the Levene's test was less </span></span>
<span><span class="co"># than 0.05, and the `t.test` function would then run a Welch's two-sample test.</span></span>
<span><span class="fu">t.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, var.equal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Two Sample t-test

data:  gallstones$Height by gallstones$Gender
t = -3.6619, df = 35, p-value = 0.00082
alternative hypothesis: true difference in means between group F and group M is not equal to 0
95 percent confidence interval:
 -14.655702  -4.201441
sample estimates:
mean in group F mean in group M 
       160.5714        170.0000 </code></pre>
</div>
<p><strong>Conclusion</strong>: the p-value is significant so we can
accept the alternative hypothesis and conclude that there is a
difference in the mean height of males and females in our dataset.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Using the gallstones dataset, test whether the gallstone diameter
(“Diam”) is different between patients who suffer a recurrence and those
who do not.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualise data</span></span>
<span><span class="fu">boxplot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, col <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Diameter"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Recurrence"</span><span class="op">)</span></span>
<span><span class="co"># Test whether data is normally distributecd</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">hist</span><span class="op">)</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<p>Data is not normal for the recurrence group, and data is not paired -
hence Mann-Whitney test</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use wilcox.test function which defaults to Mann-Whitney analysis</span></span>
<span><span class="fu">wilcox.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span></span></code></pre>
</div>
<p>The p-value is not significant, so we do not have sufficient evidence
to reject the null hypothesis that there is no difference in gallstone
size between the two groups.</p>
</div>
</div>
</div>
</div>
</section><section id="group-descriptions"><h2 class="section-heading">Group descriptions<a class="anchor" aria-label="anchor" href="#group-descriptions"></a>
</h2>
<hr class="half-width">
<p>If there is a significant difference between the two groups (or even
if there isn’t) it is often useful to generate some summary statistics
for each group. We can do this with the <code>by</code> command, which
we’ve used already in this section, combined with summary functions</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For normally distributed data, report the mean and standard deviation</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Gender: F
[1] 160.5714
------------------------------------------------------------ 
gallstones$Gender: M
[1] 170</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">sd</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Gender: F
[1] 5.518799
------------------------------------------------------------ 
gallstones$Gender: M
[1] 9.993331</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For non-normally distributed data, report the median and inter-quartile range</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">median</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Rec: NoRecurrence
[1] 10
------------------------------------------------------------ 
gallstones$Rec: Recurrence
[1] 8.5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>, <span class="va">IQR</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Rec: NoRecurrence
[1] 12
------------------------------------------------------------ 
gallstones$Rec: Recurrence
[1] 9</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Many of the summary statistics can be calculated in one step with the FSA </span></span>
<span><span class="co"># Summarize function</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">FSA</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">## FSA v0.9.3. See citation('FSA') if used in publication.</span></span>
<span><span class="co">## Run fishR() for related website and fishR('IFAR') for related book.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Summarize</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Height</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  gallstones$Gender  n     mean       sd min  Q1 median     Q3 max
1                 F 21 160.5714 5.518799 147 157  161.0 163.00 170
2                 M 16 170.0000 9.993331 156 164  167.5 175.25 189</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Summarize</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Diam</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  gallstones$Rec  n     mean       sd min Q1 median Q3 max
1   NoRecurrence 21 12.42857 7.440238   3  6   10.0 18  27
2     Recurrence 16 10.06250 6.180278   4  5    8.5 14  26</code></pre>
</div>
</section><section id="paired-samples"><h2 class="section-heading">Paired samples<a class="anchor" aria-label="anchor" href="#paired-samples"></a>
</h2>
<hr class="half-width">
<p>If data is paired, that is, it is the same samples under two
different conditions, we can take advantage of that to carry out
statistical tests with greater discriminatory power. That is because by
using paired samples, we remove a lot of the noise that can otherwise
obscure our results. Paired data must have the same number of results in
each group, there must be a one-to-one relationship between the groups
(every sample that appears in one group must appear in the other), and
the data must be the same sample order in each group.</p>
<p>Otherwise, paired sample analysis is performed in a similar way to
unpaired analysis. The main difference is to add the
<code>paired = TRUE</code> argument to the <code>t.test</code> or
<code>wilcox.test</code> function.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>hist</code> and boxplots to review distribution of
variables for a group</li>
<li>Summarise grouped data using the <code>by</code> command</li>
<li>Distinguish paired and non-paired samples</li>
<li>Correctly use the <code>t.test</code> and <code>wilcox.test</code>
functions</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-06-ANOVA"><p>Content from <a href="06-ANOVA.html">Testing For More Than Two Groups</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-ANOVA.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Are the group means different among three or more groups?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Identify situations needing multiple sample tests and choose the
correct test for the type of data</li>
<li>Perform one and two-way ANOVA testing</li>
<li>Recognise interaction effects in multiple-category testing</li>
<li>Interpret test results and apply post hoc testing</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="comparison-of-multiple-groups"><h2 class="section-heading">Comparison of multiple groups<a class="anchor" aria-label="anchor" href="#comparison-of-multiple-groups"></a>
</h2>
<hr class="half-width">
<p>The T-test, Mann-Whitney Test and others discussed earlier are
designed to identify differences in the means or medians of two groups.
When working with data that is in three or more groups, where we are
testing if there is a difference between any one of those groups with
the others, we need to use other tests. As with two-sample testing, the
appropriate test is determined in large part by whether the data in each
group is normally distributed, and whether the data is paired, as
outlined in the figure below.</p>
<figure><img src="../fig/06-fig1.png" alt="Decision chart for appropriate test to use with multiple groups.  Question one: Are the normally distributed. Question 2: Are the data paired. If they are both normally distributed and paired, use Repeated Measures ANOVA. If they are normally distributed and not paired, use one-way or two-way ANOVA. If they are not normally distributed but are paired, use the Friedman test. If they are neither normally distributed nor paired, use the Kruskal-Wallace test." class="figure mx-auto d-block"></figure><div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Based on what you have learned previously in this workshop, how can
we best determine whether the data in each sample is normally
distributed</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>We can use the <code>shapiro.test</code> function to test for
normality - or rather, to test the alternative hypothesis that the data
is not normally distributed. Use the <code>by</code> function to test
all categories in one command:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">measurement</span>, <span class="va">data</span><span class="op">$</span><span class="va">category</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<p>Remember, as with the two sample tests, if any one group is not
normally distributed, the whole analysis must be performed with the
relevant non-parametric test</p>
</div>
</div>
</div>
</div>
</section><section id="anova-testing---one-way"><h2 class="section-heading">ANOVA Testing - One-way<a class="anchor" aria-label="anchor" href="#anova-testing---one-way"></a>
</h2>
<hr class="half-width">
<p>The one-way ANOVA compares whether there is a difference in the mean
values of three or more groups. It requires one continuous (and normally
distributed) measurement variable, and one categorical variable (with
three or more categories).</p>
<p>Assumptions for the one-way ANOVA are:</p>
<ul>
<li>Independant samples</li>
<li>Normal distribution in each group</li>
<li>Homogeneity of variances</li>
</ul>
<p>The null hypothesis for one-way ANOVA is that the means of all groups
are equal; the alternative hypothesis is that at least one of the means
is different from the others.</p>
<p>H<sub>0</sub>: μ<sub>1</sub> = μ<sub>2</sub> = μ<sub>3</sub> = … =
μ<sub>k</sub><br>
H<sub>1</sub>: μ<sub>1</sub> ≠ μ<sub>2</sub> OR μ<sub>1</sub> ≠
μ<sub>3</sub> OR μ<sub>2</sub> ≠ μ<sub>3</sub> ….</p>
<p>The ANOVA extension of the t-test is called the
<strong>F-test</strong>, and is based around decomposing the total
variation in the sample into the variability (sum of squares) within
groups and between groups</p>
<figure><img src="../fig/06-fig2.png" alt="Table showing the breakdown of variation between and within groups" class="figure mx-auto d-block"></figure></section><section id="anova-one-way-example"><h2 class="section-heading">ANOVA one-way example<a class="anchor" aria-label="anchor" href="#anova-one-way-example"></a>
</h2>
<hr class="half-width">
<p>In our example dataset, the alcohol consumption field has three
categories. We will test if there is any effect on weight associated
with the alcohol consumption category.</p>
<div class="section level3">
<h3 id="variables-of-interest">Variables of interest<a class="anchor" aria-label="anchor" href="#variables-of-interest"></a>
</h3>
<ul>
<li>Alcohol consumption: Categorical (1, 2 or 3)</li>
<li>Weight: Continuous</li>
</ul>
<p>There are two variables - one categorical with more than two levels
and one continuous. The data are not paired - all the measurements are
from different patients. So based on the decision tree, the appropriate
test is either one-way ANOVA or Kruskal-Wallis test. The choice between
these is made depending on whether the data is normally distributed or
not.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
NonAlcohol   Previous    Alcohol 
         9         10         18 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Alcohol.Consumption: NonAlcohol

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.79876, p-value = 0.01976

------------------------------------------------------------ 
gallstones$Alcohol.Consumption: Previous

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.95864, p-value = 0.7703

------------------------------------------------------------ 
gallstones$Alcohol.Consumption: Alcohol

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.94549, p-value = 0.3588</code></pre>
</div>
<p>The Shapiro test for group 1 gives a significant p-value, indicating
that we should reject the null hypothesis that the data is normally
distributed. This would indicate that the Kruskal-Wallis test is the
appropriate one for this analysis.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kruskal.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Kruskal-Wallis rank sum test

data:  gallstones$Weight by gallstones$Alcohol.Consumption
Kruskal-Wallis chi-squared = 0.89142, df = 2, p-value = 0.6404</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxplot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can see that with a p-value of 0.64, we reject the alternative
hypothesis and concluded that in this data set, there is no evidence for
a difference in patient weight associated with their level of alcohol
consumption. This is consistent with the plot, which doesn’t show any
clear differences between the three categories.</p>
<p>For comparison and practice, let’s also perform an ANOVA</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                               Df Sum Sq Mean Sq F value Pr(&gt;F)
gallstones$Alcohol.Consumption  2    369   184.4   0.685  0.511
Residuals                      34   9151   269.1               </code></pre>
</div>
<p>Like the Kruskal-Wallis test, this ANOVA also gives a non-significant
p-value, but remember, it is not the appropriate test for non-normally
distributed data so would not be a valid test anyway.</p>
</div>
<div class="section level3">
<h3 id="post-hoc-testing">
<em>Post-Hoc</em> testing<a class="anchor" aria-label="anchor" href="#post-hoc-testing"></a>
</h3>
<p>The one-way ANOVA and Kruskal-Wallis tests only identify that one (or
more) of the groups has a significant difference to the others. To go
further, we would want to identify which group(s) were different. For
this we would use a <strong><em>Post-hoc</em></strong>
<strong>test</strong>, either Tukeys’ HSD for ANOVA or Dunn’s test (in
the FSA package) for Kruskal-Wallis. This performs a multiple-testing
corrected pairwise comparison between each combination of groups to
highlight which (if any) are different.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dunn's test, since we used Kruskal-Wallis for the initial analysis</span></span>
<span><span class="fu">dunnTest</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Dunn (1964) Kruskal-Wallis multiple comparison</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  p-values adjusted with the Bonferroni method.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             Comparison           Z   P.unadj P.adj
1  Alcohol - NonAlcohol  0.79245283 0.4280967     1
2    Alcohol - Previous  0.75516608 0.4501493     1
3 NonAlcohol - Previous -0.05588197 0.9554358     1</code></pre>
</div>
<p>The output shows a pairwise comparison and associated p-value for
each combination of the groups being tested - groups 2 and 1 first, then
groups 3 and 1, and finally groups 3 and 2. In this example, the
p-values are all 1 - there is not evidence for even the slightest
difference between the groups!</p>
<p>If there is a significant p-value with a one-way ANOVA, use the Tukey
HSD test</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = gallstones$Weight ~ gallstones$Alcohol.Consumption)

$`gallstones$Alcohol.Consumption`
                          diff       lwr      upr     p adj
Previous-NonAlcohol -0.2777778 -18.74892 18.19336 0.9992516
Alcohol-NonAlcohol   6.1666667 -10.24537 22.57870 0.6311298
Alcohol-Previous     6.4444444  -9.41109 22.29998 0.5844049</code></pre>
</div>
<p>The layout here is similar to the Dunn’s test with one row per
comparison and the p-value reported for each pairwise comparison</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>For a more interesting analysis, try creating a dummy dataset with
the weight of patients doubled for just one category of
Alcohol.Consumption and then repeat the Kruskal-Wallis and Dunn’s tests.
Does this show a significant difference as you might expect?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a copy of the gallstones data frame so as not to break things later</span></span>
<span><span class="va">dummy_data</span> <span class="op">&lt;-</span> <span class="va">gallstones</span></span>
<span><span class="co"># Double the weight for Alcohol.Consumption category 'Alcohol'</span></span>
<span><span class="va">ac_three</span> <span class="op">&lt;-</span> <span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span> <span class="op">==</span> <span class="st">'Alcohol'</span><span class="op">)</span></span>
<span><span class="va">dummy_data</span><span class="op">[</span><span class="va">ac_three</span>, <span class="st">"Weight"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">dummy_data</span><span class="op">[</span><span class="va">ac_three</span>, <span class="st">"Weight"</span><span class="op">]</span></span>
<span><span class="co"># Then do the testing</span></span>
<span><span class="fu">kruskal.test</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">dunnTest</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, </span>
<span>                   method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Try using the dummy dataset from challenge 2 for an ANOVA and Tukey’s
test</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dummy_result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">dummy_result</span><span class="op">)</span></span>
<span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">dummy_result</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="anova-testing---two-way"><h2 class="section-heading">ANOVA Testing - Two-way<a class="anchor" aria-label="anchor" href="#anova-testing---two-way"></a>
</h2>
<hr class="half-width">
<p>An alternative application of ANOVA testing is where there are two
categorical variables (or factors) and one continuous measurement
variable. This is commonly used where the effect of a treatment or
intervention might be different between subsets of the test population -
in other words, where there is a possibility of an interaction between
the two factors. A common situation might be a different response of
male and female patients to a drug treatment, which is the example that
we will use here.</p>
<div class="section level3">
<h3 id="two-way-anova-example">Two-way ANOVA example<a class="anchor" aria-label="anchor" href="#two-way-anova-example"></a>
</h3>
<p>The dataset we will use here is a small study to investigate the
influence of Prozac on the reported ‘happiness score’ of patients, and
whether males and female patients respond differently.</p>
<ul>
<li>Happiness score recorded for 24 patients</li>
<li>Patients randomised to either placebo or Prozac
<strong>treatment</strong> (first factor)</li>
<li>Patients <strong>gender</strong> recorded (second factor)</li>
</ul>
<p>Read the data in from the file “happiness.csv”</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># As before, we need to specify the stringsAsfactors flag for read.csv</span></span>
<span><span class="va">happiness</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/happiness.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Patient Score Gender Treatment
1       1     3   Male   Placebo
2       2     4   Male   Placebo
3       3     2   Male   Placebo
4       4     3   Male   Placebo
5       5     4   Male   Placebo
6       6     3   Male   Placebo</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	24 obs. of  4 variables:
 $ Patient  : int  1 2 3 4 5 6 7 8 9 10 ...
 $ Score    : num  3 4 2 3 4 3 4 5 4 6 ...
 $ Gender   : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 1 1 1 1 ...
 $ Treatment: Factor w/ 2 levels "Placebo","Prozac": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    Patient          Score          Gender     Treatment 
 Min.   : 1.00   Min.   :2.000   Female:12   Placebo:12  
 1st Qu.: 6.75   1st Qu.:4.000   Male  :12   Prozac :12  
 Median :12.50   Median :5.000                           
 Mean   :12.50   Mean   :4.854                           
 3rd Qu.:18.25   3rd Qu.:6.000                           
 Max.   :24.00   Max.   :7.000                           </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">happiness</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        
         Placebo Prozac
  Female       6      6
  Male         6      6</code></pre>
</div>
<p>This corresponds to this design:</p>
<figure><img src="../fig/06-fig4.png" alt="Table summarising happiness scores by sex and treatment" class="figure mx-auto d-block"></figure><p>As usual, an early step in studying our data is to visualise it</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, plot just using each of the factors independently</span></span>
<span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">Score</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Gender</span>, data <span class="op">=</span> <span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Then using ggplot to separate out the four different combinations of factor</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">happiness</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Treatment</span>, y <span class="op">=</span> <span class="va">Score</span>, fill <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Judging by the boxplots, there appears to be a difference in
happiness score for the different treatment drugs (score higher with
treatment than placebo). However, the difference is less pronounced
between the gender groups.</p>
<p>Two-way ANOVA tests for two things: <strong>Main effects</strong> -
each factor independently</p>
<ul>
<li>Are patients happier on placebo or Prozac</li>
<li>Do males and females differ in happiness score</li>
</ul>
<p><strong>Interaction effects</strong> - the effects of one factor are
different depending on the level (category) of the other factor</p>
<ul>
<li>Treatment x Gender: Males may be happier on Prozac than placebo, but
females may not have a different response between the two. Or <em>vice
versa</em>. The diagram below shows examples of (left) where both main
effects have a difference but there is no interaction and (right) where
there is a strong interaction but little main effect.</li>
</ul>
<figure><img src="../fig/06-fig7.png" alt="Graph explaining interaction of variables. The first plot shows a situation with no interaction, where the effect of treatment is the same irrespective of  the sex of the patient. The second shows a situation with interaction, where the outcome  is very different for the two sexes" class="figure mx-auto d-block"></figure><p>Interaction plots can be made in R using the
<code>interaction.plot</code> command. Note the order of factors -
switching these alters which variable is plotted on the x-axis.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interaction.plot</span><span class="op">(</span><span class="va">happiness</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Score</span>,</span>
<span>                 col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The interaction plot seems to show that there is a strong interaction
effect between Treatment and Gender on happiness score, but to confirm
that we can fit a two-way ANOVA with an interaction term.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1 - the most commonly used</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                 Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Treatment         1 15.844  15.844  24.934 6.98e-05 ***
Gender            1  0.844   0.844   1.328 0.262773    
Treatment:Gender  1 11.344  11.344  17.852 0.000415 ***
Residuals        20 12.708   0.635                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 2 - gives identical results under most circumstances</span></span>
<span><span class="va">result_2</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">anova</span><span class="op">(</span><span class="va">result_2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Analysis of Variance Table

Response: Score
                 Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
Treatment         1 15.8437 15.8437 24.9344 6.977e-05 ***
Gender            1  0.8438  0.8438  1.3279 0.2627729    
Treatment:Gender  1 11.3437 11.3437 17.8525 0.0004155 ***
Residuals        20 12.7083  0.6354                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="interpretation-of-two-way-anova-output">Interpretation of two-way ANOVA output<a class="anchor" aria-label="anchor" href="#interpretation-of-two-way-anova-output"></a>
</h3>
<div class="section level4">
<h4 id="treatment">Treatment<a class="anchor" aria-label="anchor" href="#treatment"></a>
</h4>
<p>The final column Pr(&gt;F) is the p-value; at 7x10<sup>-5</sup> this
is well within the cutoff for statistical significance. Therefore we
conclude that treatment with Prozac has a significant effect on
happiness. From our plots it appears that Prozac is associated with
higher happiness scores, but this should be confirmed with <em>post
hoc</em> testing.</p>
</div>
<div class="section level4">
<h4 id="gender">Gender<a class="anchor" aria-label="anchor" href="#gender"></a>
</h4>
<p>The p-value for gender is not signficant, so there is not evidence
for a gender effect on happiness; that is, there is no difference in
happiness levels between males and females.</p>
</div>
<div class="section level4">
<h4 id="treatmentgender">Treatment:Gender<a class="anchor" aria-label="anchor" href="#treatmentgender"></a>
</h4>
<p>This has a significant p-value, indicating that there is an
interaction between gender and treatment. The plots suggest that is
because Prozac increases happiness in men more than in women, but again
this should be confirmed with <em>post hoc</em> testing.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For ANOVA performed with `aov()`, used TukeyHSD for post hoc testing</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Score ~ Treatment + Gender + Treatment * Gender, data = happiness)

$Treatment
                diff       lwr      upr    p adj
Prozac-Placebo 1.625 0.9461711 2.303829 6.98e-05

$Gender
              diff       lwr       upr     p adj
Male-Female -0.375 -1.053829 0.3038289 0.2627729

$`Treatment:Gender`
                              diff         lwr        upr     p adj
Prozac:Female-Placebo:Female  0.25 -1.03813584  1.5381358 0.9472984
Placebo:Male-Placebo:Female  -1.75 -3.03813584 -0.4618642 0.0056547
Prozac:Male-Placebo:Female    1.25 -0.03813584  2.5381358 0.0591502
Placebo:Male-Prozac:Female   -2.00 -3.28813584 -0.7118642 0.0016445
Prozac:Male-Prozac:Female     1.00 -0.28813584  2.2881358 0.1650724
Prozac:Male-Placebo:Male      3.00  1.71186416  4.2881358 0.0000132</code></pre>
</div>
<p>The \$Treatment section of this output supports our conclusion from
the two-way ANOVA that Prozac increases happiness score, by an average
of 1.6 happiness units (95% CI: 0.95-2.3). The $Treatment:Gender section
indicates that Prozac has no effect on happiness in females (or at
least, not a statistically signficant effect), but in males it increases
happiness by approximatey 3.0 units.</p>
</div>
</div>
<div class="section level3">
<h3 id="checking-assumptions">Checking assumptions<a class="anchor" aria-label="anchor" href="#checking-assumptions"></a>
</h3>
<p>After fitting an ANOVA model it is important to always check the
relevant model assumptions. This includes making QQ-plots and residual
plots.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level4">
<h4 id="characteristics-of-a-well-behaved-residual-vs--fits-plot">Characteristics of a well-behaved residual vs. fits plot<a class="anchor" aria-label="anchor" href="#characteristics-of-a-well-behaved-residual-vs--fits-plot"></a>
</h4>
<ol style="list-style-type: decimal">
<li>The residuals “bounce randomly” around the 0 line. This suggests
that the assumption that the relationship is linear is reasonable.</li>
<li>The residuals roughly form a “horizontal band” around the 0 line.
This suggests that the variances of the error terms are equal.</li>
<li>No one residual “stands out” from the basic random pattern of
residuals. This suggests that there are no outliers.</li>
</ol>
</div>
<div class="section level4">
<h4 id="characteristics-of-a-well-behaved-q-q-plot">Characteristics of a well-behaved Q-Q plot<a class="anchor" aria-label="anchor" href="#characteristics-of-a-well-behaved-q-q-plot"></a>
</h4>
<ol style="list-style-type: decimal">
<li>If the points on the q-q plot fall approximately on a straight line,
the residuals are considered to be normally distributed.</li>
<li>If some points are far from the line have a deeper look to see if
they are outliers.</li>
</ol>
<p><strong><em>In this case, it appears that there is a deviation from
normality because many of the points do not fall on the straight
line.</em></strong></p>
</div>
<div class="section level4">
<h4 id="scale-location-plot">Scale location plot<a class="anchor" aria-label="anchor" href="#scale-location-plot"></a>
</h4>
<p>Square root of the standardized residuals (sort of a square root of
relative error) as a function of the fitted values. Again, there should
be no obvious trend in this plot.</p>
</div>
<div class="section level4">
<h4 id="point-leverage-plot">Point Leverage plot<a class="anchor" aria-label="anchor" href="#point-leverage-plot"></a>
</h4>
<p>Measure of importance of each point in determining the regression
result. Superimposed on the plot are contour lines for the Cook’s
distance (another measure of the importance of each observation).</p>
<p>Smaller distances means that removing the observation has little
affect on the regression results. Distances larger than 2 are suspicious
and suggest the presence of a possible outlier.</p>
</div>
</div>
</section><section id="paired-data-with-more-than-two-samples"><h2 class="section-heading">Paired data with more than two samples<a class="anchor" aria-label="anchor" href="#paired-data-with-more-than-two-samples"></a>
</h2>
<hr class="half-width">
<p>The two-way ANOVA and Kruskal-Wallis test are both intended for use
with independent sets of data, as outlined in the decision tree at the
start of this section. As with several other tests we have explored in
this course, there are alternatives that should be used when data points
are paired - in other words, where there are multiple measurements on
the same subject. These are the <strong>Repeated measures ANOVA</strong>
and the <strong>Friedman test</strong>, for normally distributed and
non-normally distributed data respectively.</p>
<p>Typical study designs where you might use paired data analysis
approaches include:</p>
<ul>
<li>Studies that investigate changes in mean scores over three or more
time points</li>
<li>Studies that investigate differences in mean scores under three or
more different conditions.</li>
</ul>
<p>These more advanced tests are beyond the scope of this workshop, but
some are covered in our <strong>Longitudinal and Mixed Model
Analysis</strong> course.</p>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge4"></a>
</h3>
<div class="callout-content">
<p>Can you think of a modification to our Happiness trial example which
would mean it should be analysed using a paired data technique?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>One option would be that if, rather than testing on 24 individuals
assigned randomly to placebo/treatment groups, the trial was instead
carried out with 12 people and happiness scores recorded before and
after treatment with Prozac. Or perhaps a stricter design - 24
individuals treated with either Prozac or placebo, with happiness scores
recorded before and after treatment.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Identify situations needing multiple sample tests and choose the
relevant test using the decision tree</li>
<li>Perform multi-group testing using <code>aov</code> and
<code>kruskal.test</code>
</li>
<li>Perform and interpret post hoc tests using <code>TukeyHSD</code> and
<code>dunnTest</code>
</li>
<li>Study interactions using <code>interaction.plot</code> and
<code>aov</code>
</li>
<li>Check model assumptions using <code>plot</code>
</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-07-Multiple-Testing"><p>Content from <a href="07-Multiple-Testing.html">Multiple testing, summary, and final exercises</a></p>
<hr>
<p> Last updated on 2022-12-21 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/07-Multiple-Testing.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we interpret p-values when mutiple comparisons are carried
out?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Recognise the impact of multiple testing on the meaning of
p-values</li>
<li>Adjust p-values to compensate for the effects of multiple
testing</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="multiple-testing"><h2 class="section-heading">Multiple testing<a class="anchor" aria-label="anchor" href="#multiple-testing"></a>
</h2>
<hr class="half-width">
<p>In ANOVA, if H<sub>0</sub> is rejected, we carry out a <em>post
hoc</em> test to identify which group(s) are significantly different
from the other ones. If there are three groups (A, B and C), that means
we are performing 3 comparisons:</p>
<ol style="list-style-type: decimal">
<li>A vs B</li>
<li>A vs C</li>
<li>B vs C</li>
</ol>
<p>Each time we perform a t-test, we chose a significance threshold
under which we reject the null hypothesis. A significance level of 0.05
for example means a 5% chance of making a type I error - incorrectly
rejecting H<sub>0</sub>. When performing multiple tests, that
probability of error applies for each individual comparison, so the more
tests performed, the higher likelihood of a type I error.</p>
<p>In our example three-way comparison with signficance threshold of
0.05:</p>
<ul>
<li>Prob(making no mistake) = 0.95 x 0.95 x 0.95 = 0.857</li>
<li>Prob(making a mistake) = 1 - 0.857 = 0.143</li>
</ul>
<p>So rather than a 5% chance of a type I error, we instead have a much
higher 14.3% chance, which is clearly not acceptable.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Memory test! A type I error is an incorrect rejection of the null
hypothesis. Can you remember what a type II error is?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>A type II error is a failure to reject the null hypothesis when it is
false</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="correction-for-multiple-testing">Correction for multiple testing<a class="anchor" aria-label="anchor" href="#correction-for-multiple-testing"></a>
</h3>
<p>To compensate for the effects of multiple testing on expected error
rate, we need to adjust the p-value according to the number of
hypothesis tests performed.</p>
<p>Examples of correction approaches include:</p>
<ul>
<li>False Discovery Rate (FDR): controls the type I error rate</li>
<li>Bonferroni correction (FWER): reduce the probability of even one
false discovery</li>
</ul>
<p>In R, the <code>p.adjust</code> function can be used to perform
multiple-testing correction on a vector of p-values.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a vector of multiple p-values to be tested</span></span>
<span><span class="co"># Note, most of these *individually* meet the significance threshold of &lt;0.05</span></span>
<span><span class="va">pval</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.04</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>, <span class="fl">0.03</span>, <span class="fl">0.005</span>, <span class="fl">0.0005</span><span class="op">)</span></span>
<span><span class="co"># False Discovery Rate correction - only three tests remain signficant</span></span>
<span><span class="co"># And round to 3 decimal places for neater display</span></span>
<span><span class="fu">round</span><span class="op">(</span><span class="fu">p.adjust</span><span class="op">(</span><span class="va">pval</span>, method <span class="op">=</span> <span class="st">'fdr'</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 0.050 0.033 0.071 0.067 0.125 0.600 0.556 0.060 0.025 0.005</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bonferroni correction - now only one remains significant</span></span>
<span><span class="co"># For some reason, bonferroni defaults to 3 decimal places anyway</span></span>
<span><span class="fu">p.adjust</span><span class="op">(</span><span class="va">pval</span>, method <span class="op">=</span> <span class="st">'bonferroni'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 0.200 0.100 0.500 0.400 1.000 1.000 1.000 0.300 0.050 0.005</code></pre>
</div>
</div>
</section><section id="summary-of-relevant-statistical-tests"><h2 class="section-heading">Summary of relevant statistical tests<a class="anchor" aria-label="anchor" href="#summary-of-relevant-statistical-tests"></a>
</h2>
<hr class="half-width">
<p>This table can be used as a reference to select the appropriate test
to use from a given experimental design</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Analysis required (continuous data)</th>
<th>Normally distributed data</th>
<th>Non-normally distributed data</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Compare mean or median of one sample group against a known
value</td>
<td>One sample t-test</td>
<td>Wilcoxon Rank Sum test</td>
</tr>
<tr class="even">
<td>Compare means or medians of two sample groups (unpaired data)</td>
<td>Unpaired t-test</td>
<td>Mann-Whitney test</td>
</tr>
<tr class="odd">
<td>Compare means or medians of two sample groups (paired data)</td>
<td>Paired t-test</td>
<td>Wilcoxon Matched Pairs test</td>
</tr>
<tr class="even">
<td>Compare means or medians of ≥ three sample groups (unpaired
data)</td>
<td>ANOVA</td>
<td>Kruskal-Wallis ANOVA</td>
</tr>
<tr class="odd">
<td>Compare means or medians of ≥ three sample groups (paired data)</td>
<td>Repeated measures ANOVA</td>
<td>Friedman test</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Analysis required (categorical data)</th>
<th>Test used</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Compare two sample proportions of categorical data (unpaired data,
≤5 in one group)</td>
<td>Fisher exact test</td>
</tr>
<tr class="even">
<td>Compare two sample proportions of categorical data (unpaired data,
&gt;5 in all groups)</td>
<td>Chi-square test</td>
</tr>
<tr class="odd">
<td>Compare two sample proportions of categorical data (paired
data)</td>
<td>McNemar test</td>
</tr>
</tbody>
</table></section><section id="summary-of-r-functions"><h2 class="section-heading">Summary of R functions<a class="anchor" aria-label="anchor" href="#summary-of-r-functions"></a>
</h2>
<hr class="half-width">
<ul>
<li>Check for normality: <code>shapiro.test(var)</code>
</li>
<li>Correlation (normally distributed)
<code>cor.test(var1,var2,method="pearson")</code>
</li>
<li>Correlation (Non-normally distributed)
<code>cor.test(var1,var2,method="spearman")</code>
</li>
<li>Chi-square <code>chisq.test(table(var1,var2))</code>
</li>
<li>Fisher’s exact (≤5 counts)
<code>fisher.test(table(var1,var2))</code>
</li>
<li>Unpaired t-test <code>t.test(var1~var2)</code>
</li>
<li>Paired t-test <code>t.test(var1~var2,paired=TRUE)</code>
</li>
<li>Wilcoxon Rank Sum test <code>wilcox.test(var1~var2)</code>
</li>
<li>Wilcoxon Matched Pairs Test
<code>wilcox.test(var1~var2,paired=TRUE)</code>
</li>
<li>Compare &gt;2 groups for one factor</li>
<li>ANOVA <code>aov(outcome~factor1)</code>
</li>
<li>Kruskal-Wallis ANOVA <code>kruskal.test(outcome~factor1)</code>
</li>
</ul></section><section id="final-practice-exercises"><h2 class="section-heading">Final practice exercises<a class="anchor" aria-label="anchor" href="#final-practice-exercises"></a>
</h2>
<hr class="half-width">
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Do patients with multiple gallstones experience more recurrences than
those with single stones?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The variables of interest are multiple stones (categorical, 2 groups)
and recurrence (categorical, 2 groups). The appropriate test is
therefore either Chi-square or Fisher’s Exact, depending on the expected
count for each category</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the frequency table</span></span>
<span><span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Mult</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Complete Cross-table</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gmodels</span><span class="op">)</span></span>
<span><span class="fu">CrossTable</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Mult</span>,format<span class="op">=</span><span class="st">"SPSS"</span>,prop.chisq<span class="op">=</span><span class="cn">F</span>,expected<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualisation</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gallstones</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Rec</span>, fill<span class="op">=</span><span class="va">Mult</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>position<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="va">percent</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span>,</span>
<span>        legend.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span>,</span>
<span>        legend.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span>,</span>
<span>        axis.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">22</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Recurrence vs. Mult"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Chi-square test performed because more than 5 expected counts in each cell</span></span>
<span><span class="fu">chisq.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Mult</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>With a p-value of 0.1295, there is no evidence for a significant
association between gallstone recurrence and the presence of multiple
stones</p>
</div>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Is the patient’s age associated with gallstone recurrence?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The variables of interest are gallstone recurrence (categorical, 2
groups) and age (continuous). The appropriate test is therefore either
the t-test or Mann-Whitney test, depending on whether the data is
normally distributed or not</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test normality in both groups</span></span>
<span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span><span class="op">[</span><span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">==</span><span class="st">"NoRecurrence"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span><span class="op">[</span><span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">==</span><span class="st">"Recurrence"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other option</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">shapiro.test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We have to perform a Mann-Whitney test </span></span>
<span><span class="fu">wilcox.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Boxplots to visualise</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,col<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Age"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Recurrence"</span>,cex.lab<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Statistical descriptions</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">median</span><span class="op">)</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">IQR</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Age</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Rec</span>,<span class="va">sd</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="conclusion-1">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-1"></a>
</h3>
<p>With a p-value of 0.7707, there is no evidence for a significant
association between gallstone recurrence and the age of patients</p>
</div>
</div>
</div>
</div>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge4"></a>
</h3>
<div class="callout-content">
<p>Does alcohol consumption influence the time to gallstone
dissolution?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>The variables of interest are alcohol consumption (categorical, 3
groups) and dissolution time (continuous). The appropriate test is
therefore either ANOVA or Kruskal-Wallis, depending on whether the data
is normally distributed or not</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test normality in each groups</span></span>
<span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span>,<span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>,<span class="va">shapiro.test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If distribution normal in each group</span></span>
<span><span class="va">result</span><span class="op">&lt;-</span><span class="fu">aov</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If distribution not normal</span></span>
<span><span class="fu">kruskal.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualisation</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>,col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="conclusion-2">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-2"></a>
</h3>
<p>With a p-value of 0.2389, there is no evidence for a significant
association between alcohol consumption and dissolution time</p>
</div>
</div>
</div>
</div>
</div>
<div id="challenge5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge 5<a class="anchor" aria-label="anchor" href="#challenge5"></a>
</h3>
<div class="callout-content">
<p>Is there any effect of treatment and/or gender on the time to
dissolution?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Solution to Challenge 5
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>The variables of interest are gender (categorical, 2 groups),
treatment (categorical, two groups) and dissolution time (continuous).
The appropriate test is therefore a two-way ANOVA</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualisation</span></span>
<span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">Dis</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">gallstones</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interaction plot to visualise</span></span>
<span><span class="fu">interaction.plot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Dis</span>,</span>
<span>                 col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">3</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># anova 2 way with aov function</span></span>
<span><span class="va">result</span><span class="op">&lt;-</span><span class="fu">aov</span><span class="op">(</span><span class="va">Dis</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>,data<span class="op">=</span><span class="va">gallstones</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># anova 2 way with lm function</span></span>
<span><span class="va">result</span><span class="op">&lt;-</span><span class="fu">lm</span><span class="op">(</span><span class="va">Dis</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>,data<span class="op">=</span><span class="va">gallstones</span><span class="op">)</span></span>
<span><span class="fu">anova</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Checking the assumptions of anova</span></span>
<span></span>
<span><span class="va">result</span><span class="op">&lt;-</span><span class="fu">lm</span><span class="op">(</span><span class="va">Dis</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>,data<span class="op">=</span><span class="va">gallstones</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="conclusion-3">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-3"></a>
</h3>
<p>With a p-value of &lt;0.0016, there is evidence for a significant
effect of treatment on dissolution time. There is no evidence for a
difference between genders for dissolution time, nor evidence for an
interaction between treatment and gender (both males and females have a
similar response).</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="finishing-up"><h2 class="section-heading">Finishing up<a class="anchor" aria-label="anchor" href="#finishing-up"></a>
</h2>
<hr class="half-width">
<p>It is always a good idea to conclude any R analysis with the
<code>sessionInfo()</code> command to save with the output as a
permanent record of software versions being used. This helps resolve
issues where updated versions of tools may give different analysis
outcomes.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>R version 4.2.2 Patched (2022-11-10 r83330)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.1 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] FSA_0.9.3        ggplot2_3.4.0    gmodels_2.18.1.1

loaded via a namespace (and not attached):
 [1] knitr_1.41       magrittr_2.0.3   MASS_7.3-58.1    tidyselect_1.2.0
 [5] munsell_0.5.0    colorspace_2.0-3 R6_2.5.1         rlang_1.0.6     
 [9] fansi_1.0.3      dplyr_1.0.10     stringr_1.5.0    tools_4.2.2     
[13] grid_4.2.2       gtable_0.3.1     xfun_0.35        utf8_1.2.2      
[17] cli_3.4.1        withr_2.5.0      gtools_3.9.4     tibble_3.1.8    
[21] lifecycle_1.0.3  vctrs_0.5.1      glue_1.6.2       evaluate_0.18   
[25] gdata_2.18.0.1   stringi_1.7.8    compiler_4.2.2   pillar_1.8.1    
[29] generics_0.1.3   scales_1.2.1     renv_0.16.0      pkgconfig_2.0.3 </code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Understand the impact of multiple testing on p-values</li>
<li>Use <code>p.adjust</code> to correct multiple-testing p-values</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
        
        
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:training@qcif.edu.au">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">Not for reuse without permission</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.11.3" class="external-link">sandpaper (0.11.3)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.3.2" class="external-link">pegboard (0.3.2)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.11" class="external-link">varnish (0.2.11)</a>.</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/instructor/aio.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/instructor/aio.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/instructor/aio.html",
  "dateCreated": "2022-12-21",
  "dateModified": "2022-12-21",
  "datePublished": "2022-12-21"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

