<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Statistical Comparisons using R: Testing For More Than Two Groups</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #383838">Beta
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="color: #001483; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../06-ANOVA.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Statistical Comparisons using R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Statistical Comparisons using R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Statistical Comparisons using R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 71%" class="percentage">
    71%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 71%" aria-valuenow="71" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../06-ANOVA.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-Hypothesis-Testing.html">1. Introduction to Hypothesis Testing</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-Preparation-of-data.html">2. Preparation of Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-Correlation.html">3. Relationship Between Continuous Variables</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-Categorical-Variables.html">4. Categorical Variables</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-Continuous-Variable.html">5. Comparison Between Two Groups</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        Testing For More Than Two Groups
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#comparison-of-multiple-groups">Comparison of multiple groups</a></li>
<li><a href="#anova-testing---one-way">ANOVA Testing - One-way</a></li>
<li><a href="#anova-one-way-example">ANOVA one-way example</a></li>
<li><a href="#anova-testing---two-way">ANOVA Testing - Two-way</a></li>
<li><a href="#paired-data-with-more-than-two-samples">Paired data with more than two samples</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-Multiple-Testing.html">7. Multiple testing, summary, and final exercises</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-Continuous-Variable.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-Multiple-Testing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-Continuous-Variable.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Comparison Between</a>
        <a class="chapter-link float-end" href="../instructor/07-Multiple-Testing.html" rel="next">Next: Multiple testing,... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Testing For More Than Two Groups</h1>
        <p> Last updated on 2022-12-22 | 
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-ANOVA.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 55 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>Are the group means different among three or more groups?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Identify situations needing multiple sample tests and choose the
correct test for the type of data</li>
<li>Perform one and two-way ANOVA testing</li>
<li>Recognise interaction effects in multiple-category testing</li>
<li>Interpret test results and apply post hoc testing</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="comparison-of-multiple-groups"><h2 class="section-heading">Comparison of multiple groups<a class="anchor" aria-label="anchor" href="#comparison-of-multiple-groups"></a>
</h2>
<hr class="half-width"><p>The T-test, Mann-Whitney Test and others discussed earlier are
designed to identify differences in the means or medians of two groups.
When working with data that is in three or more groups, where we are
testing if there is a difference between any one of those groups with
the others, we need to use other tests. As with two-sample testing, the
appropriate test is determined in large part by whether the data in each
group is normally distributed, and whether the data is paired, as
outlined in the figure below.</p>
<figure><img src="../fig/06-fig1.png" alt="Decision chart for appropriate test to use with multiple groups.  Question one: Are the normally distributed. Question 2: Are the data paired. If they are both normally distributed and paired, use Repeated Measures ANOVA. If they are normally distributed and not paired, use one-way or two-way ANOVA. If they are not normally distributed but are paired, use the Friedman test. If they are neither normally distributed nor paired, use the Kruskal-Wallace test." class="figure mx-auto d-block"></figure><div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Based on what you have learned previously in this workshop, how can
we best determine whether the data in each sample is normally
distributed</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solution to Challenge 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>We can use the <code>shapiro.test</code> function to test for
normality - or rather, to test the alternative hypothesis that the data
is not normally distributed. Use the <code>by</code> function to test
all categories in one command:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">measurement</span>, <span class="va">data</span><span class="op">$</span><span class="va">category</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<p>Remember, as with the two sample tests, if any one group is not
normally distributed, the whole analysis must be performed with the
relevant non-parametric test</p>
</div>
</div>
</div>
</div>
</section><section id="anova-testing---one-way"><h2 class="section-heading">ANOVA Testing - One-way<a class="anchor" aria-label="anchor" href="#anova-testing---one-way"></a>
</h2>
<hr class="half-width"><p>The one-way ANOVA compares whether there is a difference in the mean
values of three or more groups. It requires one continuous (and normally
distributed) measurement variable, and one categorical variable (with
three or more categories).</p>
<p>Assumptions for the one-way ANOVA are:</p>
<ul><li>Independant samples</li>
<li>Normal distribution in each group</li>
<li>Homogeneity of variances</li>
</ul><p>The null hypothesis for one-way ANOVA is that the means of all groups
are equal; the alternative hypothesis is that at least one of the means
is different from the others.</p>
<p>H<sub>0</sub>: µ<sub>1</sub> = µ<sub>2</sub> = µ<sub>3</sub> = … =
µ<sub>k</sub><br>
H<sub>1</sub>: µ<sub>1</sub> ≠ µ<sub>2</sub> OR µ<sub>1</sub> ≠
µ<sub>3</sub> OR µ<sub>2</sub> ≠ µ<sub>3</sub> ….</p>
<p>The ANOVA extension of the t-test is called the
<strong>F-test</strong>, and is based around decomposing the total
variation in the sample into the variability (sum of squares) within
groups and between groups</p>
<figure><img src="../fig/06-fig2.png" alt="Table showing the breakdown of variation between and within groups" class="figure mx-auto d-block"></figure></section><section id="anova-one-way-example"><h2 class="section-heading">ANOVA one-way example<a class="anchor" aria-label="anchor" href="#anova-one-way-example"></a>
</h2>
<hr class="half-width"><p>In our example dataset, the alcohol consumption field has three
categories. We will test if there is any effect on weight associated
with the alcohol consumption category.</p>
<div class="section level3">
<h3 id="variables-of-interest">Variables of interest<a class="anchor" aria-label="anchor" href="#variables-of-interest"></a></h3>
<ul><li>Alcohol consumption: Categorical (1, 2 or 3)</li>
<li>Weight: Continuous</li>
</ul><p>There are two variables - one categorical with more than two levels
and one continuous. The data are not paired - all the measurements are
from different patients. So based on the decision tree, the appropriate
test is either one-way ANOVA or Kruskal-Wallis test. The choice between
these is made depending on whether the data is normally distributed or
not.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
NonAlcohol   Previous    Alcohol 
         9         10         18 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">by</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span>, <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, <span class="va">shapiro.test</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gallstones$Alcohol.Consumption: NonAlcohol

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.79876, p-value = 0.01976

------------------------------------------------------------ 
gallstones$Alcohol.Consumption: Previous

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.95864, p-value = 0.7703

------------------------------------------------------------ 
gallstones$Alcohol.Consumption: Alcohol

	Shapiro-Wilk normality test

data:  dd[x, ]
W = 0.94549, p-value = 0.3588</code></pre>
</div>
<p>The Shapiro test for group 1 gives a significant p-value, indicating
that we should reject the null hypothesis that the data is normally
distributed. This would indicate that the Kruskal-Wallis test is the
appropriate one for this analysis.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kruskal.test</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Kruskal-Wallis rank sum test

data:  gallstones$Weight by gallstones$Alcohol.Consumption
Kruskal-Wallis chi-squared = 0.89142, df = 2, p-value = 0.6404</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxplot</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can see that with a p-value of 0.64, we reject the alternative
hypothesis and concluded that in this data set, there is no evidence for
a difference in patient weight associated with their level of alcohol
consumption. This is consistent with the plot, which doesn’t show any
clear differences between the three categories.</p>
<p>For comparison and practice, let’s also perform an ANOVA</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                               Df Sum Sq Mean Sq F value Pr(&gt;F)
gallstones$Alcohol.Consumption  2    369   184.4   0.685  0.511
Residuals                      34   9151   269.1               </code></pre>
</div>
<p>Like the Kruskal-Wallis test, this ANOVA also gives a non-significant
p-value, but remember, it is not the appropriate test for non-normally
distributed data so would not be a valid test anyway.</p>
</div>
<div class="section level3">
<h3 id="post-hoc-testing">
<em>Post-Hoc</em> testing<a class="anchor" aria-label="anchor" href="#post-hoc-testing"></a></h3>
<p>The one-way ANOVA and Kruskal-Wallis tests only identify that one (or
more) of the groups has a significant difference to the others. To go
further, we would want to identify which group(s) were different. For
this we would use a <strong><em>Post-hoc</em></strong>
<strong>test</strong>, either Tukeys’ HSD for ANOVA or Dunn’s test (in
the FSA package) for Kruskal-Wallis. This performs a multiple-testing
corrected pairwise comparison between each combination of groups to
highlight which (if any) are different.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dunn's test, since we used Kruskal-Wallis for the initial analysis</span></span>
<span><span class="fu">dunnTest</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Dunn (1964) Kruskal-Wallis multiple comparison</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  p-values adjusted with the Bonferroni method.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             Comparison           Z   P.unadj P.adj
1  Alcohol - NonAlcohol  0.79245283 0.4280967     1
2    Alcohol - Previous  0.75516608 0.4501493     1
3 NonAlcohol - Previous -0.05588197 0.9554358     1</code></pre>
</div>
<p>The output shows a pairwise comparison and associated p-value for
each combination of the groups being tested - groups 2 and 1 first, then
groups 3 and 1, and finally groups 3 and 2. In this example, the
p-values are all 1 - there is not evidence for even the slightest
difference between the groups!</p>
<p>If there is a significant p-value with a one-way ANOVA, use the Tukey
HSD test</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = gallstones$Weight ~ gallstones$Alcohol.Consumption)

$`gallstones$Alcohol.Consumption`
                          diff       lwr      upr     p adj
Previous-NonAlcohol -0.2777778 -18.74892 18.19336 0.9992516
Alcohol-NonAlcohol   6.1666667 -10.24537 22.57870 0.6311298
Alcohol-Previous     6.4444444  -9.41109 22.29998 0.5844049</code></pre>
</div>
<p>The layout here is similar to the Dunn’s test with one row per
comparison and the p-value reported for each pairwise comparison</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>For a more interesting analysis, try creating a dummy dataset with
the weight of patients doubled for just one category of
Alcohol.Consumption and then repeat the Kruskal-Wallis and Dunn’s tests.
Does this show a significant difference as you might expect?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution to Challenge 2
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a copy of the gallstones data frame so as not to break things later</span></span>
<span><span class="va">dummy_data</span> <span class="op">&lt;-</span> <span class="va">gallstones</span></span>
<span><span class="co"># Double the weight for Alcohol.Consumption category 'Alcohol'</span></span>
<span><span class="va">ac_three</span> <span class="op">&lt;-</span> <span class="fu">which</span><span class="op">(</span><span class="va">gallstones</span><span class="op">$</span><span class="va">Alcohol.Consumption</span> <span class="op">==</span> <span class="st">'Alcohol'</span><span class="op">)</span></span>
<span><span class="va">dummy_data</span><span class="op">[</span><span class="va">ac_three</span>, <span class="st">"Weight"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">dummy_data</span><span class="op">[</span><span class="va">ac_three</span>, <span class="st">"Weight"</span><span class="op">]</span></span>
<span><span class="co"># Then do the testing</span></span>
<span><span class="fu">kruskal.test</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">dunnTest</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span><span class="op">~</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span>, </span>
<span>                   method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Try using the dummy dataset from challenge 2 for an ANOVA and Tukey’s
test</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Challenge 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dummy_result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">dummy_data</span><span class="op">$</span><span class="va">Weight</span> <span class="op">~</span> <span class="va">dummy_data</span><span class="op">$</span><span class="va">Alcohol.Consumption</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">dummy_result</span><span class="op">)</span></span>
<span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">dummy_result</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="anova-testing---two-way"><h2 class="section-heading">ANOVA Testing - Two-way<a class="anchor" aria-label="anchor" href="#anova-testing---two-way"></a>
</h2>
<hr class="half-width"><p>An alternative application of ANOVA testing is where there are two
categorical variables (or factors) and one continuous measurement
variable. This is commonly used where the effect of a treatment or
intervention might be different between subsets of the test population -
in other words, where there is a possibility of an interaction between
the two factors. A common situation might be a different response of
male and female patients to a drug treatment, which is the example that
we will use here.</p>
<div class="section level3">
<h3 id="two-way-anova-example">Two-way ANOVA example<a class="anchor" aria-label="anchor" href="#two-way-anova-example"></a></h3>
<p>The dataset we will use here is a small study to investigate the
influence of Prozac on the reported ‘happiness score’ of patients, and
whether males and female patients respond differently.</p>
<ul><li>Happiness score recorded for 24 patients</li>
<li>Patients randomised to either placebo or Prozac
<strong>treatment</strong> (first factor)</li>
<li>Patients <strong>gender</strong> recorded (second factor)</li>
</ul><p>Read the data in from the file “happiness.csv”</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># As before, we need to specify the stringsAsfactors flag for read.csv</span></span>
<span><span class="va">happiness</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/happiness.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Patient Score Gender Treatment
1       1     3   Male   Placebo
2       2     4   Male   Placebo
3       3     2   Male   Placebo
4       4     3   Male   Placebo
5       5     4   Male   Placebo
6       6     3   Male   Placebo</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	24 obs. of  4 variables:
 $ Patient  : int  1 2 3 4 5 6 7 8 9 10 ...
 $ Score    : num  3 4 2 3 4 3 4 5 4 6 ...
 $ Gender   : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 1 1 1 1 ...
 $ Treatment: Factor w/ 2 levels "Placebo","Prozac": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    Patient          Score          Gender     Treatment 
 Min.   : 1.00   Min.   :2.000   Female:12   Placebo:12  
 1st Qu.: 6.75   1st Qu.:4.000   Male  :12   Prozac :12  
 Median :12.50   Median :5.000                           
 Mean   :12.50   Mean   :4.854                           
 3rd Qu.:18.25   3rd Qu.:6.000                           
 Max.   :24.00   Max.   :7.000                           </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">happiness</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        
         Placebo Prozac
  Female       6      6
  Male         6      6</code></pre>
</div>
<p>This corresponds to this design:</p>
<figure><img src="../fig/06-fig4.png" alt="Table summarising happiness scores by sex and treatment" class="figure mx-auto d-block"></figure><p>As usual, an early step in studying our data is to visualise it</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, plot just using each of the factors independently</span></span>
<span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">Score</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Gender</span>, data <span class="op">=</span> <span class="va">happiness</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Then using ggplot to separate out the four different combinations of factor</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">happiness</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Treatment</span>, y <span class="op">=</span> <span class="va">Score</span>, fill <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Judging by the boxplots, there appears to be a difference in
happiness score for the different treatment drugs (score higher with
treatment than placebo). However, the difference is less pronounced
between the gender groups.</p>
<p>Two-way ANOVA tests for two things: <strong>Main effects</strong> -
each factor independently</p>
<ul><li>Are patients happier on placebo or Prozac</li>
<li>Do males and females differ in happiness score</li>
</ul><p><strong>Interaction effects</strong> - the effects of one factor are
different depending on the level (category) of the other factor</p>
<ul><li>Treatment x Gender: Males may be happier on Prozac than placebo, but
females may not have a different response between the two. Or <em>vice
versa</em>. The diagram below shows examples of (left) where both main
effects have a difference but there is no interaction and (right) where
there is a strong interaction but little main effect.</li>
</ul><figure><img src="../fig/06-fig7.png" alt="Graph explaining interaction of variables. The first plot shows a situation with no interaction, where the effect of treatment is the same irrespective of  the sex of the patient. The second shows a situation with interaction, where the outcome  is very different for the two sexes" class="figure mx-auto d-block"></figure><p>Interaction plots can be made in R using the
<code>interaction.plot</code> command. Note the order of factors -
switching these alters which variable is plotted on the x-axis.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interaction.plot</span><span class="op">(</span><span class="va">happiness</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Gender</span>, <span class="va">happiness</span><span class="op">$</span><span class="va">Score</span>,</span>
<span>                 col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The interaction plot seems to show that there is a strong interaction
effect between Treatment and Gender on happiness score, but to confirm
that we can fit a two-way ANOVA with an interaction term.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1 - the most commonly used</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                 Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Treatment         1 15.844  15.844  24.934 6.98e-05 ***
Gender            1  0.844   0.844   1.328 0.262773    
Treatment:Gender  1 11.344  11.344  17.852 0.000415 ***
Residuals        20 12.708   0.635                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 2 - gives identical results under most circumstances</span></span>
<span><span class="va">result_2</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">anova</span><span class="op">(</span><span class="va">result_2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Analysis of Variance Table

Response: Score
                 Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
Treatment         1 15.8437 15.8437 24.9344 6.977e-05 ***
Gender            1  0.8438  0.8438  1.3279 0.2627729    
Treatment:Gender  1 11.3437 11.3437 17.8525 0.0004155 ***
Residuals        20 12.7083  0.6354                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="interpretation-of-two-way-anova-output">Interpretation of two-way ANOVA output<a class="anchor" aria-label="anchor" href="#interpretation-of-two-way-anova-output"></a></h3>
<div class="section level4">
<h4 id="treatment">Treatment<a class="anchor" aria-label="anchor" href="#treatment"></a></h4>
<p>The final column Pr(&gt;F) is the p-value; at 7x10<sup>-5</sup> this
is well within the cutoff for statistical significance. Therefore we
conclude that treatment with Prozac has a significant effect on
happiness. From our plots it appears that Prozac is associated with
higher happiness scores, but this should be confirmed with <em>post
hoc</em> testing.</p>
</div>
<div class="section level4">
<h4 id="gender">Gender<a class="anchor" aria-label="anchor" href="#gender"></a></h4>
<p>The p-value for gender is not signficant, so there is not evidence
for a gender effect on happiness; that is, there is no difference in
happiness levels between males and females.</p>
</div>
<div class="section level4">
<h4 id="treatmentgender">Treatment:Gender<a class="anchor" aria-label="anchor" href="#treatmentgender"></a></h4>
<p>This has a significant p-value, indicating that there is an
interaction between gender and treatment. The plots suggest that is
because Prozac increases happiness in men more than in women, but again
this should be confirmed with <em>post hoc</em> testing.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For ANOVA performed with `aov()`, used TukeyHSD for post hoc testing</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">Score</span><span class="op">~</span><span class="va">Treatment</span><span class="op">+</span><span class="va">Gender</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Gender</span>, data<span class="op">=</span><span class="va">happiness</span><span class="op">)</span></span>
<span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Score ~ Treatment + Gender + Treatment * Gender, data = happiness)

$Treatment
                diff       lwr      upr    p adj
Prozac-Placebo 1.625 0.9461711 2.303829 6.98e-05

$Gender
              diff       lwr       upr     p adj
Male-Female -0.375 -1.053829 0.3038289 0.2627729

$`Treatment:Gender`
                              diff         lwr        upr     p adj
Prozac:Female-Placebo:Female  0.25 -1.03813584  1.5381358 0.9472984
Placebo:Male-Placebo:Female  -1.75 -3.03813584 -0.4618642 0.0056547
Prozac:Male-Placebo:Female    1.25 -0.03813584  2.5381358 0.0591502
Placebo:Male-Prozac:Female   -2.00 -3.28813584 -0.7118642 0.0016445
Prozac:Male-Prozac:Female     1.00 -0.28813584  2.2881358 0.1650724
Prozac:Male-Placebo:Male      3.00  1.71186416  4.2881358 0.0000132</code></pre>
</div>
<p>The \<span class="math inline">\(Treatment section of this output
supports our conclusion from the two-way ANOVA that Prozac increases
happiness score, by an average of 1.6 happiness units (95% CI:
0.95-2.3). The \\\)</span>Treatment:Gender section indicates that Prozac
has no effect on happiness in females (or at least, not a statistically
signficant effect), but in males it increases happiness by approximately
3.0 units.</p>
</div>
</div>
<div class="section level3">
<h3 id="checking-assumptions">Checking assumptions<a class="anchor" aria-label="anchor" href="#checking-assumptions"></a></h3>
<p>After fitting an ANOVA model it is important to always check the
relevant model assumptions. This includes making QQ-plots and residual
plots.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/06-ANOVA-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level4">
<h4 id="characteristics-of-a-well-behaved-residual-vs--fits-plot">Characteristics of a well-behaved residual vs. fits plot<a class="anchor" aria-label="anchor" href="#characteristics-of-a-well-behaved-residual-vs--fits-plot"></a></h4>
<ol style="list-style-type: decimal"><li>The residuals “bounce randomly” around the 0 line. This suggests
that the assumption that the relationship is linear is reasonable.</li>
<li>The residuals roughly form a “horizontal band” around the 0 line.
This suggests that the variances of the error terms are equal.</li>
<li>No one residual “stands out” from the basic random pattern of
residuals. This suggests that there are no outliers.</li>
</ol></div>
<div class="section level4">
<h4 id="characteristics-of-a-well-behaved-q-q-plot">Characteristics of a well-behaved Q-Q plot<a class="anchor" aria-label="anchor" href="#characteristics-of-a-well-behaved-q-q-plot"></a></h4>
<ol style="list-style-type: decimal"><li>If the points on the q-q plot fall approximately on a straight line,
the residuals are considered to be normally distributed.</li>
<li>If some points are far from the line have a deeper look to see if
they are outliers.</li>
</ol><p><strong><em>In this case, it appears that there is a deviation from
normality because many of the points do not fall on the straight
line.</em></strong></p>
</div>
<div class="section level4">
<h4 id="scale-location-plot">Scale location plot<a class="anchor" aria-label="anchor" href="#scale-location-plot"></a></h4>
<p>Square root of the standardized residuals (sort of a square root of
relative error) as a function of the fitted values. Again, there should
be no obvious trend in this plot.</p>
</div>
<div class="section level4">
<h4 id="point-leverage-plot">Point Leverage plot<a class="anchor" aria-label="anchor" href="#point-leverage-plot"></a></h4>
<p>Measure of importance of each point in determining the regression
result. Superimposed on the plot are contour lines for the Cook’s
distance (another measure of the importance of each observation).</p>
<p>Smaller distances means that removing the observation has little
affect on the regression results. Distances larger than 2 are suspicious
and suggest the presence of a possible outlier.</p>
</div>
</div>
</section><section id="paired-data-with-more-than-two-samples"><h2 class="section-heading">Paired data with more than two samples<a class="anchor" aria-label="anchor" href="#paired-data-with-more-than-two-samples"></a>
</h2>
<hr class="half-width"><p>The two-way ANOVA and Kruskal-Wallis test are both intended for use
with independent sets of data, as outlined in the decision tree at the
start of this section. As with several other tests we have explored in
this course, there are alternatives that should be used when data points
are paired - in other words, where there are multiple measurements on
the same subject. These are the <strong>Repeated measures ANOVA</strong>
and the <strong>Friedman test</strong>, for normally distributed and
non-normally distributed data respectively.</p>
<p>Typical study designs where you might use paired data analysis
approaches include:</p>
<ul><li>Studies that investigate changes in mean scores over three or more
time points</li>
<li>Studies that investigate differences in mean scores under three or
more different conditions.</li>
</ul><p>These more advanced tests are beyond the scope of this workshop, but
some are covered in our <strong>Longitudinal and Mixed Model
Analysis</strong> course.</p>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge4"></a>
</h3>
<div class="callout-content">
<p>Can you think of a modification to our Happiness trial example which
would mean it should be analysed using a paired data technique?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Solution to Challenge 4
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>One option would be that if, rather than testing on 24 individuals
assigned randomly to placebo/treatment groups, the trial was instead
carried out with 12 people and happiness scores recorded before and
after treatment with Prozac. Or perhaps a stricter design - 24
individuals treated with either Prozac or placebo, with happiness scores
recorded before and after treatment.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Identify situations needing multiple sample tests and choose the
relevant test using the decision tree</li>
<li>Perform multi-group testing using <code>aov</code> and
<code>kruskal.test</code>
</li>
<li>Perform and interpret post hoc tests using <code>TukeyHSD</code> and
<code>dunnTest</code>
</li>
<li>Study interactions using <code>interaction.plot</code> and
<code>aov</code>
</li>
<li>Check model assumptions using <code>plot</code>
</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-Continuous-Variable.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-Multiple-Testing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-Continuous-Variable.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Comparison Between</a>
        <a class="chapter-link float-end" href="../instructor/07-Multiple-Testing.html" rel="next">Next: Multiple testing,... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/06-ANOVA.Rmd" class="external-link">Edit on GitHub</a>
        
        
        
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:training@qcif.edu.au">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">Not for reuse without permission</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.11.3" class="external-link">sandpaper (0.11.3)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.3.2" class="external-link">pegboard (0.3.2)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.12" class="external-link">varnish (0.2.12)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/instructor/06-ANOVA.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Testing For More Than Two Groups",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/instructor/06-ANOVA.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/instructor/06-ANOVA.html",
  "dateCreated": "2022-12-22",
  "dateModified": "2022-12-22",
  "datePublished": "2022-12-22"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

